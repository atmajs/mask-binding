(function(e,t){"use strict";function n(e,t){for(var n=0,r=t.length-1;r>n;n++){var i=t.shift();null==e[i]&&(e[i]={}),e=e[i]}return e}function r(e,t){for(var n=t.split("."),r=n.length,i=0;r>i;i++){if(null==e)return null;e=e[n[i]]}return e}function i(e,t,n){for(var r=t.split("."),i=r.length,o=0,s=null;i-1>o;o++)s=r[o],null==e[s]&&(e[s]={}),e=e[s];e[r[o]]=n}function o(e,t,i){if(null==e.__observers&&Object.defineProperty(e,"__observers",{value:{},enumerable:!1}),e.__observers[t]){e.__observers[t].push(i);var o=r(e,t);return o instanceof Array&&h(o,i),void 0}var s=e.__observers[t]=[i],l=t.split("."),a=l.length>1?n(e,l):e,u=l[0],c=a[u];Object.defineProperty(a,u,{get:function(){return c},set:function(e){c=e;for(var t=0,n=s.length;n>t;t++)s[t](e);c instanceof Array&&h(c,i)}}),c instanceof Array&&h(c,i)}function s(e,t,n){if(null!=e.__observers&&null!=e.__observers[t]){var o=r(e,t);if(2===arguments.length)return i(e,t,o),delete e.__observers[t],void 0;a(e.__observers[t],n),o instanceof Array&&a(o.__observers,n)}}function l(e,t){if(null==t)return e;null==e&&(e={});for(var n in t)e[n]=t[n];return e}function a(e){if(null==e)return!1;for(var t,n=0,r=e.length,i=1,o=arguments.length,s=0;r>n;n++)for(t=e[n],i=1;o>i;i++)if(arguments[i]===t){e.splice(n,1),n--,r--,s++;break}return s+1===o}function u(e){return Array.prototype.slice.call(e)}function h(e,t){function n(t){e[t]=function(){var e=this.__observers,n=u(arguments),r=Array.prototype[t].apply(this,n);if(null==e||0===e.length)return r;for(var i,o=0,s=e.length;s>o;o++)i=e[o],"function"==typeof i&&i(this,t,n);return r}}null==e.__observers&&Object.defineProperty(e,"__observers",{value:[],enumerable:!1});for(var r=0,i=["push","unshift","splice","pop","shift","reverse","sort"],o=i.length;o>r;r++)n(i[r]);e.__observers.push(t),e=null}function c(e){return e.parentNode.removeChild(e)}function d(e){if(null!=e)for(var t=0,n=e.length;n>t;t++)c(e[t])}function f(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function p(e,t){return t.parentNode.insertBefore(e,t)}function m(e,t,n){return"function"==typeof A?(A(e).on(t,n),void 0):null!=e.addEventListener?(e.addEventListener(t,n,!1),void 0):(e.attachEvent&&e.attachEvent("on"+t,n),void 0)}function v(e,t,n){if(null==e.components)return f(n,e.placeholder);for(var r,i=e.components,o=null,s=!0,l=i.length,a=t;l>a;a++)if(r=i[a].elements,r&&r.length){o=r[0];break}if(null==o)for(s=!1,a=l>t?t:l;--a>-1;)if(r=i[a].elements,r&&r.length){o=r[r.length-1];break}return null==o&&(o=e.placeholder),s?p(n,o):f(n,o)}function g(e,n,r,i,o){return t.render(n,r,i,o,e)}function b(e,t){if(null==e)return!1;d(e.elements),e.elements=null,"undefined"!=typeof Compo&&Compo.dispose(e);var n=t&&t.components||e.parent&&e.parent.components;return null==n?(console.error("Parent Components Collection is undefined"),!1):a(n,e)}function y(e){"undefined"!=typeof Compo&&Compo.signal.emitIn(e,"domInsert")}function C(e,t){if("function"==typeof e.dispose){var n=e.dispose;return e.dispose=function(){t(),n()},void 0}e.dispose=t}function w(e,t,n,r,i){var s=B(e),l=H(s),a=$(s,t);if(null==l)return a;if("string"==typeof l)return o(t,l,i),a;for(var u,h=0,c=l.length;c>h;h++)u=l[h],o(t,u,i);return a}function _(e,t,n){var r=B(e),i=H(r);if(null!=i){if("string"==typeof i)return s(t,i,n),void 0;for(var o=0,l=i.length;l>o;o++)s(t,i[o],n)}}function k(e,t,n,r,i){return function(){i($(e,t,n,r))}}function x(){}function j(){}function E(){}function N(e,t){if(null==t&&(t=[]),null==e.components)return t;for(var n,r=e.components,i=0,o=r.length;o>i;i++)n=r[i],"validate"!==n.compoName?N(n):t.push(n);return t}var A=window.jQuery||window.Zepto||window.$;null==A&&console.warn("Without jQuery/Zepto etc. binder is limited (mouse dom event bindings)");var L=t.Utils.Expression,$=L.eval,B=L.parse,H=L.varRefs,U=function(){function e(e,t,n,r){null==r&&(r=":bind"===n.compoName?"single":"dual"),this.node=n,this.model=e,this.element=t,this.value=n.attr.value,this.property=n.attr.property||("single"===r?"element.innerHTML":"element.value"),this.setter=n.attr.setter,this.getter=n.attr.getter,this.dismiss=0,this.bindingType=r}function n(e){var t=e.node.attr.value,n=e.model,r=e.objectChanged=e.objectChanged.bind(e);if(o(n,t,r),"dual"===e.bindingType){var i=e.element,s=e.node.attr.changeEvent||"change",l=e.domChanged.bind(e);m(i,s,l)}return e.objectChanged(),e}t.registerBinding=function(e,t){a[e]=t};var a={},u=t.Utils.Expression;return e.create=function(t,r,i,o){var s,u=i.attr.bindingProvider||r.tagName.toLowerCase(),h=a[u];return h instanceof Function?new h(t,r,i,o):(s=new e(t,r,i,o),null!=h&&l(s,h),n(s))},e.prototype={constructor:e,dispose:function(){s(this.model,this.value,this.objectChanged)},objectChanged:function(e){this.dismiss-->0||(null==e&&(e=this.objectWay.get(this.model,this.node.attr.value)),this.domWay.set(this,e))},domChanged:function(){var e=this.domWay.get(this);if(this.node.validations)for(var t,n=0,r=this.node.validations.length;r>n;n++)if(t=this.node.validations[n],t.validate(e,this.element,this.objectChanged.bind(this))===!1)return;this.dismiss=1,this.objectWay.set(this.model,this.node.attr.value,e),this.dismiss=0},objectWay:{get:function(e,t){return":"===t[0]?u.eval(t.substring(1),e):r(e,t)},set:function(e,t,n){i(e,t,n)}},domWay:{get:function(e){if(e.getter){var t=e.node.parent;return null==t||"function"!=typeof t[e.getter]?(console.error("Mask.bindings: Getter should be a function",e.getter,e),null):t[e.getter]()}return r(e,e.property)},set:function(e,t){if(e.setter){var n=e.node.parent;if(null==n||"function"!=typeof n[e.setter])return console.error("Mask.bindings: Getter should be a function",e.getter,e),void 0;n[e.setter](t)}else i(e,e.property,t)}}},e}();t.registerHandler(":visible",x),x.prototype={constructor:x,refresh:function(e,n){n.style.display=t.Utils.Condition.isCondition(this.attr.check,e)?"":"none"},renderStart:function(e,t,n){this.refresh(e,n),this.attr.bind&&o(e,this.attr.bind,this.refresh.bind(this,e,n))}},function(){function e(){}t.registerHandler(":bind",e),e.prototype={constructor:e,renderStart:function(e,t,n){this.provider=U.create(e,n,this,"single")},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),t.registerHandler(":dualbind",j),j.prototype={constructor:j,renderEnd:function(e,t,n,r){if(this.components)for(var i,o=0,s=this.components.length;s>o;o++)i=this.components[o],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);this.provider=U.create(t,r,this)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}},function(){function e(){}function n(e,t,n){console.warn("Validate Notification:",e,t);var r=A(e).next(".-validate-invalid");0===r.length&&(r=A("<div>").addClass("-validate-invalid").html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),n&&n()}).end().children("span").text(t).end().show()}function i(e){A(e).next(".-validate-invalid").hide()}t.registerValidator=function(e,t){o[e]=t},t.registerHandler(":validate",e),e.prototype={constructor:e,renderStart:function(e,t,n){this.element=n,this.model=e},validate:function(e,t,o){null==t&&(t=this.element),this.attr.getter&&(e=r({node:this,element:t},this.attr.getter)),null==this.validators&&this.initValidators();for(var s,l=0,a=this.validators.length;a>l;l++)if(s=this.validators[l],s.validate(this,e)===!1)return n(t,this.message,o),!1;return i(t),!0},initValidators:function(){this.validators=[],this.message=this.attr.message,delete this.attr.message;for(var e in this.attr)if(e in o!=!1){var t=o[e];"function"==typeof t&&(t=new t(this)),this.validators.push(t)}else console.error("Unknown Validator:",e,this)}};var o={match:{validate:function(e,t){return RegExp(e.attr.match).test(t)}},unmatch:{validate:function(e,t){return!RegExp(e.attr.unmatch).test(t)}},minLength:{validate:function(e,t){return t.length>=parseInt(e.attr.minLength,10)}},maxLength:{validate:function(e,t){return t.length<=parseInt(e.attr.maxLength,10)}}}}(),t.registerHandler(":validate:group",E),E.prototype={constructor:E,validate:function(){for(var e,t=N(this),n=0,r=t.length;r>n;n++)if(e=t[n],!e.validate())return!1;return!0}},function(){function e(e,t,n,r,i){return function(t){switch(e){case"node":n.textContent=t;break;case"attr":var o=n.getAttribute(i),s=o?o.replace(r,t):t;n.setAttribute(i,s),r=t}}}t.registerUtility("bind",function(t,n,r,i,o,s,l){var a=$(t,n,r,o),u=e(l,t,i,a,s),h=k(t,n,r,o,u);return w(t,n,r,o,h),"node"===l&&(i=document.createTextNode(a)),C(o,function(){_(t,n,h)}),"node"===l?i:"attr"===l?a:(console.error("Unknown binding type",arguments),"Unknown")})}(),function(e){function t(){}e.registerHandler("%%",t);var n=function(){var t={refresh:function(t){if(this.model=t,this.elements)for(var n,r=0,i=this.elements.length;i>r;r++)n=this.elements[r],n.parentNode.removeChild(n);"undefined"!=typeof Compo&&Compo.dispose(this),e.render(this.nodes,this.model,this.cntx).insertBefore(this.placeholder)}};return function(e,n,r,i){var o=e.attr.use;e.placeholder=document.createComment(""),e.model=w(o,n,r,e,t.refresh.bind(e)),i.appendChild(e.placeholder)}}(),r=function(){return function(e,t,n){function r(e){console.log("Logger > Key: %s, Value: %s",i,e)}var i=e.attr.log,o=w(i,t,n,e,r);r(o),e=null,t=null,n=null}}(),i=function(){var t={refresh:function(t){(null!=this.elements||t)&&(null==this.elements?(e.render(this.template,this.model,this.cntx,null,this).insertBefore(this.placeholder),this.$=A(this.elements)):(null==this.$&&(this.$=A(this.elements)),this.$[t?"show":"hide"]()),this.onchange&&this.onchange(t))}};return function(e,n,r,i){var o=e.attr["if"];e.placeholder=document.createComment(""),e.template=e.nodes,e.state=!!w(o,n,r,e,t.refresh.bind(e)),e.state||(e.nodes=null),i.appendChild(e.placeholder)}}(),o=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return p(g(this,this.template,this.model,this.cntx)),this.$=A(this.elements),void 0;null==this.$&&(this.$=A(this.elements)),this.$[e?"hide":"show"]()}}};return function(t,n,r,i){var o=t.parent.components,s=o&&o[o.length-1];return t.template=t.nodes,t.placeholder=document.createComment(""),null==s||"%%"!==s.compoName||null==s.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(s.onchange=e.refresh.bind(t),s.state&&(t.nodes=null),i.appendChild(t.placeholder),void 0)}}(),s=function(){function t(e,t){var n=[];if(t instanceof Array==!1)return n;for(var r,i=0,s=t.length;s>i;i++){switch(r=t[i],typeof r){case"string":case"number":case"boolean":r=t[i]=Object(r)}n[i]=new o(e.template,r,e)}return n}function n(e,t){for(var n=e.components,r=0,i=n.length,o=0,s=null,l=null,a=null,u=document.createDocumentFragment(),h=[];i>r;r++)if(a=n[r],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)l=a.elements[o],l.parentNode.removeChild(l);e:for(o=0,s=t.length;s>o;o++){for(r=0;i>r;r++)if(t[o]===n[r].model){h[o]=n[r];continue e}console.warn("No Model Found for",t[o])}for(r=0,i=h.length;i>r;r++)if(a=h[r],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)l=a.elements[o],u.appendChild(l);e.components=h,p(u,e.placeholder)}function r(e,n,r,o,s){if(null!=n&&null!=r){var l=n,a=n+r;for(a>e.components.length&&(a=e.components.length);a>l;l++)b(e.components[l],e)&&(l--,a--)}if(null!=o&&s&&s.length){var u=new i,h=t(e,s),c=g(u,h),d=u.components;v(e,o,c),y(u),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[o,0].concat(d))}}var i=e.Dom.Component,o=function(){function e(e,t,n){this.nodes=e,this.model=t,this.parent=n}var t=i.prototype;e.prototype={constructor:s,renderEnd:function(e){this.elements=e}};for(var n in t)e.prototype[n]=t[n];return e}(),s={append:function(t){var n=new o(this.template,t,this);e.render(n,t,null,this.container,this)}},l={refresh:function(e,i,o){var s,l,a=0;if(null==i){for(a=0,l=this.components.length;l>a;a++)s=this.components[a],b(s,this)&&(a--,l--);return this.components=[],this.nodes=t(this,e),p(g(this,this.nodes),this.placeholder),void 0}for(l=e.length;l>a;a++)switch(s=e[a],typeof s){case"string":case"number":case"boolean":e[a]=Object(s)}switch(i){case"push":r(this,null,null,e.length,e.slice(e.length-1));break;case"pop":r(this,e.length,1);break;case"unshift":r(this,null,null,0,e.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var u=o[0],h=1===o.length?this.components.length:o[1],c=o.length>2?e.slice(o[0],o.length-2+o[0]):null;r(this,u,h,u,c);break;case"sort":case"reverse":n(this,e)}},dispose:function(){_(this.expr,this.model,this.refresh)}};return function(e,n,r,i){null==e.nodes&&"undefined"!=typeof Compo&&Compo.ensureTemplate(e),e.refresh=l.refresh.bind(e),e.dispose=l.dispose.bind(e),e.expr=e.attr.each||e.attr.foreach;var o=w(e.expr,n,r,e,e.refresh);e.template=e.nodes,e.container=i,e.placeholder=document.createComment(""),i.appendChild(e.placeholder);for(var a in s)e[a]=s[a];e.nodes=t(e,o)}}();t.prototype={constructor:t,elements:null,renderStart:function(e,t,l){var a=this.attr;if(null==a["debugger"])return null!=a.use?(n(this,e,t,l),void 0):null!=a.log?(r(this,e,t,l),void 0):(this.model=e,null!=a["if"]?(i(this,e,t,l),void 0):null!=a["else"]?(o(this,e,t,l),void 0):((null!=a.each||null!=a.foreach)&&s(this,e,t,l),void 0))},render:null,renderEnd:function(e){this.elements=e}}}(t)})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);