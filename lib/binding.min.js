!function(e,n){"use strict";function t(e,n){return function(){return e.apply(n,arguments)}}function r(e){return e.parentNode.removeChild(e)}function i(e){if(null!=e)for(var n=e.length,t=-1;++t<n;)r(e[t])}function o(e,n){return n.parentNode.insertBefore(e,n.nextSibling)}function l(e,n){return n.parentNode.insertBefore(e,n)}function s(e,n,t,r){if(null==e.components)return o(t,r||e.placeholder);var i,s=e.components,u=null,a=!0,h=s.length,c=n-1;if(null==u)for(;++c<h;)if(i=s[c].elements,i&&i.length){u=i[0];break}if(null==u)for(a=!1,c=h>n?n:h;--c>-1;)if(i=s[c].elements,i&&i.length){u=i[i.length-1];break}return null==u&&(u=r||e.placeholder),a?l(t,u):o(t,u)}function u(e,t,r,i,o){return n.render(t,r,i,o,e)}function a(e,n){if(null==e)return!1;null!=e.elements&&(i(e.elements),e.elements=null),E.dispose(e);var t=n&&n.components||e.parent&&e.parent.components;return null==t?(log_error("Parent Components Collection is undefined"),!1):A(t,e)}function h(e){E.signal.emitIn(e,"domInsert")}function c(e,n){if("function"==typeof e.dispose){var t=e.dispose;return void(e.dispose=function(){n.call(this),t.call(this)})}e.dispose=n}function d(){}function f(){}function p(){}function g(e,n){if(null==n&&(n=[]),null==e.components)return n;for(var t,r=e.components,i=0,o=r.length;o>i;i++)t=r[i],"validate"!==t.compoName?g(t):n.push(t);return n}var m,v,b,_,y,x,C,w,k,N=n.build,j=e.jQuery||e.Zepto||e.$,E="undefined"!=typeof Compo?Compo:n.Compo||e.Compo,S=E.Dom.addEventListener,O=n.registerHandler,T=n.registerAttrHandler,M=n.registerUtil,$=Array.prototype.slice;!function(){function e(e,n){for(var t,r=-1,i=n.length-1;++r<i;)t=n[r],null==e[t]&&(e[t]={}),e=e[t];return e}function n(n,r,i,o){var l=o.length,s=l>1?e(n,o):n,u=o[l-1],a=s[u];return l>1&&t(n,o),"length"===u&&I(s)?(P(s,function(e,n,t,r){for(var o=i.length,l=-1;++l<o;)i[l](e,n,t,r)}),a):(Object.defineProperty(s,u,{get:function(){return a},set:function(e){var n=0,t=i.length;if(e!==a){if(a=e,I(e))for(n=0;t>n;n++)P(e,i[n]);if(null!=i.__dirties)return void(i.__dirties[r]=1);for(n=0;t>n;n++)i[n](e)}},configurable:!0,enumerable:!0}),a)}function t(e,n){for(var t,o=i(e),l="",s=0,u=n.length-1;u>s;s++)t=n[s],l+=t+".",r(l,e,t,o),e=e[t]}function r(e,n,t,r){var i,o=n[t];Object.defineProperty(n,t,{get:function(){return o},set:function(n){n!==o&&(i=o,o=n,r(e,i))},configurable:!0,enumerable:!0})}function i(e){return function(n,t){var r=e.__observers;if(null!=r)for(var i in r)if(0===i.indexOf(n)){var o=r[i].slice(0),l=o.length,s=0;if(0!==l){var u,a,h=m(e,i);for(s=0;l>s;s++)u=o[s],y(e,i,u),a=i.substring(n.length),y(t,a,u);for(s=0;l>s;s++)o[s](h);for(s=0;l>s;s++)b(e,i,o[s])}}}}function o(e,n,t){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var r=e.__observers;return null!=r[n]?-1===H(r[n],t)&&r[n].push(t):r[n]=[t],r[n]}m=function(e,n){for(var t=n.split("."),r=t.length,i=-1;++i<r;){if(null==e)return null;e=e[t[i]]}return e},v=function(e,n,t){for(var r,i=n.split("."),o=i.length-1,l=-1;++l<o;)r=i[l],null==e[r]&&(e[r]={}),e=e[r];e[i[l]]=t},b=function(e,t,r){for(var i=t.split("."),l=i.length,s=-1,u=e;++s<l&&(u=u[i[s]],null!=u);)if(null!=u.__observers){var a=i.slice(s+1).join(".");if(u.__observers[a]){o(u,a,r);var h=o(e,t,r);if(1===h.length){var c=i.splice(0,s);0!==c.length&&n(e,t,h,c,!0)}return}}var h=o(e,t,r);1===h.length&&n(e,t,h,i,!0);var d=m(e,t);I(d)&&P(d,r)},_=function(e,n,t){for(var r=n.split("."),i=r.length,o=-1,l=e;++o<i&&(l=l[r[o]],null!=l);)if(null!=l.__observers){if(_(l,r.slice(o).join("."),t))return!0;break}var s=e.__observers;return null==s||null==s[n]?!1:-1!==H(s[n],t)},y=function(e,n,t){for(var r=n.split("."),i=r.length,o=-1,l=e;++o<i&&(l=l[r[o]],null!=l);)if(null!=l.__observers){y(l,r.slice(o).join("."),t);break}var s=e.__observers;if(null!=s&&null!=s[n]){var u=m(e,n);if(2===arguments.length)return void(s[n].length=0);A(s[n],t),I(u)&&D(u,t)}},x=function(e){if(I(e))return void V(e);var n=e.__observers;null!=n&&(n.__dirties={})},C=function(e){if(I(e))return void B(e);var n=e.__observers,t=null==n?null:n.__dirties;if(null!=t){for(var r in t){var i=e.__observers[r],o=m(e,r);if(null!=i)for(var l=0,s=i.length;s>l;l++)i[l](o)}n.__dirties=null}},w=function(e,n){if(null==n)return e;null==e&&(e={});for(var t in n)e[t]=n[t];return e},k=function(e,n){if(null==e)return!1;for(var t=n.split("."),r=t.length,i=-1;++i<r;)if(null==(e=e[t[i]]))return!1;return!0}}();var I,A,F,H,P,D,V,B;!function(){function e(e,t,r){return function(){return n(e,t,r,$.call(arguments))}}function n(e,n,t,r){var i=e.__observers&&e.__observers.__array,o=n.apply(e,r);if(null==i||0===i.length)return o;if(null!=e.__observers.__dirty)return e.__observers.__dirty=!0,o;for(var l,s=0,u=i.length;u>s;s++)l=i[s],"function"==typeof l&&l(e,t,r,o);return o}I=function(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.splice},A=function(e){if(null==e)return!1;for(var n,t=0,r=e.length,i=1,o=arguments.length,l=0;r>t;t++)for(n=e[t],i=1;o>i;i++)if(arguments[i]===n){e.splice(t,1),t--,r--,l++;break}return l+1===o},P=function(n,t){null==n.__observers&&Object.defineProperty(n,"__observers",{value:{__dirty:null},enumerable:!1});var r=n.__observers.__array;if(null==r&&(r=n.__observers.__array=[]),0===r.length)for(var i,o,l=0,s=["push","unshift","splice","pop","shift","reverse","sort","remove"],u=s.length;u>l;l++)o=s[l],i=n[o],null!=i&&(n[o]=e(n,i,o));r[r.length++]=t},D=function(e,n){var t=e.__observers&&e.__observers.__array;if(null!=t)for(var r=0,i=t.length;i>r;r++)if(t[r]===n){t[r]=null;for(var o=r;i>o;o++)t[o]=t[o+1];i--,t.length--}},V=function(e){null!=e.__observers&&(e.__observers.__dirty=!1)},B=function(e){var n=e.__observers,t=n&&n.__array;if(null!=t&&n.__dirty===!0){for(var r,i=0,o=t.length;o>i;i++)r=t[i],"function"==typeof r&&r(e);n.__dirty=null}},F=function(e,n){for(var t=0,r=e.length;r>t;t++)n(e[t])},H=function(e,n){return e.indexOf(n)}}();var L,R,W,U,z,G,K;!function(){function e(e,n,r,i,o){if(null!=i){var l=typeof i,s=t(n,r,i,l);if(null!=s){var u="object"===l?i.ref:i;e(s,u,o)}}}function t(e,n,t,r){if("object"===r){var o=i(t.accessor,e,null,n);return null==o||"object"!=typeof o?(log_error("Binding failed to an object over accessor",t),null):o}if(null==t||"$c"===t)return null;if(k(e,t))return e;if(k(n,t))return n;for(var l,s=n;null!=s;){if(l=s.scope,null!=l&&k(l,t))return l;s=s.parent}return e}var r=n.Utils.Expression,i=r.eval;G=r.parse,K=r.varRefs,L=function(e,n,t,r){if("."===e)return n;var o=i(e,n,t,r);return null==o?"":o},R=function(n,t,r,i,o){if("."===n)return void(I(t)&&P(t,o));var l=G(n),s=K(l,t,r,i);if(null!=s){if("string"==typeof s)return void e(b,t,i,s,o);for(var u,a=null!=s.length&&"function"==typeof s.splice,h=a===!0?s.length:1,c=0;h>c;c++)u=a===!0?s[c]:s,e(b,t,i,u,o)}},W=function(n,t,r,i){if("function"==typeof r&&log_warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===n)return void D(t,i);var o,l=K(n,t,null,r);if(null!=l){if("string"==typeof l)return void e(y,t,r,l,i);for(var o,s=null!=l.length&&"function"==typeof l.splice,u=s===!0?l.length:1,a=0;u>a;a++)o=s===!0?l[a]:l,e(y,t,r,o,i)}},U=function(e,n,t,r,i){var o=0;return function(){if(++o>1)return o=0,void log_warn("<mask:bind:expression> Concurent binder detected",e);var l=L(e,n,t,r);if(arguments.length>1){var s=$.call(arguments);s[0]=l,i.apply(this,s)}else i(l);o--}},z=function(e){var n=0;return function(){return++n>1?(n=0,void log_warn("<mask:listener:expression> concurent binder")):(e(),void n--)}}}();var Q,X;!function(){Q=function(e,n,t){for(var r,i,o,l,s=e.split(";"),u=[],a=0,h=s.length;h>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(o=2===r.length?r[0]:t,i=r[2===r.length?1:0],l=X(i.trim(),o,n),null!=l&&u.push(l)):log_error('Too much ":" in a signal def.',s[a]);return u},X=function(e,n,t){if(t!==!0)return{signal:e,type:n};var r=e.indexOf(".");return-1===r?(log_error("No pipe name in a signal",e),null):{signal:e.substring(r+1),pipe:e.substring(0,r),type:n}}}();var Z=function(){function e(e,n,t,r){null==r&&(r=":bind"===t.compoName?"single":"dual");var i,l=t.attr;if(this.node=t,this.controller=t,this.model=e,this.element=n,this.value=l.value,this.property=l.property,this.setter=l.setter,this.getter=l.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(n.tagName){case"INPUT":if(i=n.getAttribute("type"),"checkbox"===i){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=o.SELECT;break;default:this.property="element.innerHTML"}if(l.log&&(this.log=!0,"log"!==l.log&&(this.logExpression=l.log)),l["x-signal"]){var s=Q(l["x-signal"],null,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["signal_"+u+"Changed"]=s.signal;break;default:log_error("Signal typs is not supported",s)}}if(l["x-pipe-signal"]){var s=Q(l["x-pipe-signal"],!0,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["pipe_"+u+"Changed"]=s;break;default:log_error("Pipe type is not supported")}}if(l["dom-slot"]){this.slots={};var a=t.parent,h=a.parent;a.parent=this,this.parent=h,this.slots[l["dom-slot"]]=function(e,n){this.domChanged(e,n)}}var c=l["object-pipe-slot"]||l["x-pipe-slot"];if(c){var d=c,f=d.indexOf("."),p=d.substring(0,f),s=d.substring(f+1);this.pipes={},this.pipes[p]={},this.pipes[p][s]=function(){this.objectChanged()},E.pipe.addController(this)}if(l.expression){if(this.expression=l.expression,null==this.value&&"single"!==r){var g=K(this.expression);"string"==typeof g?this.value=g:log_warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function t(e){var n=e.expression,t=e.model,r=e.objectChanged=e.objectChanged.bind(e);if(e.binder=U(n,t,e.cntx,e.node,r),R(n,t,e.cntx,e.node,e.binder),"dual"===e.bindingType){var i=e.node.attr;if(!i["change-slot"]&&!i["change-pipe-event"]){var o=e.element,l=i["change-event"]||i.changeEvent||"change",s=e.domChanged.bind(e);S(o,l,s)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function r(e,n,t){var i=e.slots;(null==i||"function"!=typeof i[n]||i[n].apply(e,t)!==!1)&&null!=e.parent&&r(e.parent,n,t)}var i={};n.registerBinding=function(e,n){i[e]=n},n.BindingProvider=e,e.create=function(n,t,r,o){var l,s=r.attr.bindingProvider,u=null==s?null:i[s];return"function"==typeof u?new u(n,t,r,o):(l=new e(n,t,r,o),null!=u&&w(l,u),l)},e.bind=function(e){return t(e)},e.prototype={constructor:e,dispose:function(){W(this.expression,this.model,this.controller,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return void log_warn("Concurance change detected",this);if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&r(this.node,this.signal_objectChanged,[e]),this.pipe_objectChanged){var n=this.pipe_objectChanged;E.pipe(n.pipe).emit(n.signal)}this.locked=!1}},domChanged:function(e,n){if(this.locked===!0)return void log_warn("Concurance change detected",this);this.locked=!0;var t=n||this.domWay.get(this),i=!0;if(this.node.validations)for(var o,l=0,s=this.node.validations.length;s>l;l++)if(o=this.node.validations[l],o.validate(t,this.element,this.objectChanged.bind(this))===!1){i=!1;break}if(i&&(this.dismiss=1,this.objectWay.set(this.model,this.value,t),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",t),this.signal_domChanged&&r(this.node,this.signal_domChanged,[t]),this.pipe_domChanged)){var u=this.pipe_domChanged;E.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(e,n){return L(n,e.model,e.cntx,e.controller)},set:function(e,n,t){v(e,n,t)}},domWay:{get:function(e){if(e.getter){var n=e.node.parent;return null==n||"function"!=typeof n[e.getter]?(log_error("Mask.bindings: Getter should be a function",e.getter,e),null):n[e.getter]()}return m(e,e.property)},set:function(e,n){if(e.setter){var t=e.node.parent;if(null==t||"function"!=typeof t[e.setter])return void log_error("Mask.bindings: Setter should be a function",e.setter,e);t[e.setter](n)}else v(e,e.property,n)}}};var o={SELECT:{get:function(e){var n=e.element;return-1===n.selectedIndex?"":n.options[n.selectedIndex].getAttribute("name")},set:function(e,n){for(var t,r=e.element,i=0,o=r.options.length;o>i;i++)if(t=r.options[i],t.getAttribute("name")==n)return void(r.selectedIndex=i)}}};return w(e,{addObserver:b,removeObserver:y}),e}();O(":visible",d),d.prototype={constructor:d,refresh:function(e,n){n.style.display=L(this.attr.check,e)?"":"none"},renderStart:function(e,n,t){this.refresh(e,t),this.attr.bind&&b(e,this.attr.bind,this.refresh.bind(this,e,t))}},function(){function e(){}O(":bind",e),e.prototype={constructor:e,renderEnd:function(e,n,t,r){this.provider=Z.create(n,r,this,"single"),Z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),O(":dualbind",f),f.prototype={constructor:f,renderEnd:function(e,t,r,i){if(this.provider=Z.create(t,i,this),this.components)for(var o,l=0,s=this.components.length;s>l;l++)o=this.components[l],":validate"===o.compoName&&(this.validations||(this.validations=[])).push(o);if(!this.attr["no-validation"]&&!this.validations){var u=t.Validate,a=this.provider.value;if(null==u&&-1!==a.indexOf(".")){for(var h=a.split("."),l=0,c=h.length,d=t[h[0]];null==u&&++l<c&&d;)u=d.Validate,d=d[h[l]];a=h.slice(l).join(".")}var f=u&&u[a];"function"==typeof f&&(f=n.getHandler(":validate").createCustom(i,f),(this.validations||(this.validations=[])).push(f))}Z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function e(){}function t(e,n){this.fn=e,this.message=n}function r(e,n,t){log_warn("Validate Notification:",e,n);var r=j(e).next("."+o);return 0===r.length&&(r=j("<div>").addClass(o).html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),t&&t()}).end().children("span").text(n).end().show()}function i(e){return j(e).next("."+o).hide()}var o="-validate-invalid";n.registerValidator=function(e,n){l[e]=n},O(":validate",e),e.prototype={constructor:e,attr:{},renderStart:function(n,r,i){if(this.element=i,this.attr.value){var o=e.resolveFromModel(n,this.attr.value);o&&(this.validators=[new t(o)])}},validate:function(e,n,t){null==n&&(n=this.element),this.attr&&(null==e&&this.attr.getter&&(e=m({node:this,element:n},this.attr.getter)),null==e&&this.attr.value&&(e=m(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,i=0,o=this.validators.length;o>i;i++)if(r=this.validators[i].validate(e),r&&!this.attr.silent)return this.notifyInvalid(n,r,t),!1;return this.makeValid(n),!0},notifyInvalid:function(e,n,t){return r(e,n,t)},makeValid:function(e){return i(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in l!=!1){var n=l[e];this.validators.push(new t(n(this.attr[e],this),this.attr.message))}else log_error("Unknown Validator:",e,this)}}},e.resolveFromModel=function(e,n){return m(e.Validate,n)},e.createCustom=function(n,r){var i=new e;return i.element=n,i.validators=[new t(r)],i},t.prototype.validate=function(e){var n=this.fn(e);return n===!1?this.message||"Invalid - "+e:n},O(":validate:message",Compo({template:"div."+o+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,n){var t=this;this.model.message=e,this.compos.button.off().on(function(){t.hide(),n&&n()}),this.$.show()},hide:function(){this.$.hide()}}));var l={match:function(e){return function(n){return new RegExp(e).test(n)}},unmatch:function(e){return function(n){return!new RegExp(e).test(n)}},minLength:function(e){return function(n){return n.length>=parseInt(e,10)}},maxLength:function(e){return function(n){return n.length<=parseInt(e,10)}},check:function(e,n){return function(t){return L("x"+e,n.model,{x:t},n)}}}}(),O(":validate:group",p),p.prototype={constructor:p,validate:function(){for(var e,n=g(this),t=0,r=n.length;r>t;t++)if(e=n[t],!e.validate())return!1;return!0}},function(){function e(e,n,t){return e?null==n||""===n?e+" "+t:e.replace(n,t):t}function n(e){return function(n){e.textContent=n}}function t(n,t,r){return function(i){var o=n.getAttribute(t),l=e(o,r,i);n.setAttribute(t,l),r=i}}function r(n,t,r){return function(i){switch(typeof n[t]){case"boolean":return void(r=n[t]=!!i);case"number":return void(r=n[t]=Number(i));case"string":return void(r=n[t]=e(n[t],r,i));default:return void log_warn("Unsupported elements property type",t)}}}function i(e,i,o,l,s){if("node"===e)return n(o);if("attr"===e){switch(s){case"value":case"disabled":case"checked":case"selected":case"selectedIndex":return r(o,s,l)}return t(o,s,l)}throw Error("Unexpected binder type: "+e)}function o(e,n,t,r,o,l,s,u){var a=i(u,n,o,e,s),h=U(n,t,r,l,a);R(n,t,r,l,h),c(l,function(){W(n,t,l,h)})}M("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,n,t,r,i){var o=L(e,n,t,i);return this.element=document.createTextNode(o),this.current=o},node:function(e,n,t,r,i){return o(this.current,e,n,t,this.element,i,null,"node"),this.element},attrRenderStart:function(e,n,t,r,i){return this.current=L(e,n,t,i)},attr:function(e,n,t,r,i,l){return o(this.current,e,n,t,r,i,l,"attr"),this.current}})}(),T("xx-visible",function(e,n,t,r,i,o){var l=U(n,t,r,o,function(e){i.style.display=e?"":"none"});R(n,t,r,o,l),c(o,function(){W(n,t,o,l)}),L(n,t,r,o)||(i.style.display="none")}),T("x-toggle","client",function(e,n,t,r,i,o){var l=n.substring(0,n.indexOf(":")),s=n.substring(l.length+1),u=K(s);"string"!=typeof u&&(u=u[0]),S(i,l,function(){var e=L(s,t,r,o);v(t,u,e)})}),T("x-class-toggle","client",function(e,n,t,r,i){var o=n.substring(0,n.indexOf(":")),l=n.substring(o.length+1).trim();S(i,o,function(){j(i).toggleClass(l)})}),function(e){function n(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",n);var t=function(){var e={refresh:function(e){this.model=e,this.elements&&(i(this.elements),this.elements=[]),null!=E&&E.dispose(this),l(u(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){W(this.expr,this.originalModel,this,this.binder)}};return function(n,t,r,i){var o=n.attr.use;w(n,{expr:o,placeholder:document.createComment(""),binder:U(o,t,r,n,e.refresh.bind(n)),originalModel:t,model:L(o,t,r,n),dispose:e.dispose}),R(o,t,r,n,n.binder),i.appendChild(n.placeholder)}}(),r=function(){return function(e,n,t){function r(e){console.log("Logger > Key: %s, Value: %s",i,e)}var i=e.attr.log,o=U(i,n,t,e,r),l=L(i,n,t,e);R(i,n,t,e,o),c(e,function(){W(i,n,e,o)}),r(l)}}(),o=function(){function e(e,n){return function(){return e.apply(n,arguments)}}var n={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(l(u(this,this.template,this.model,this.cntx),this.placeholder),this.$=j(this.elements)):(null==this.$&&(this.$=j(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){W(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(t,r,i,o){var l=t.attr["if"];w(t,{expr:l,template:t.nodes,placeholder:document.createComment(""),binder:U(l,r,i,t,e(n.refresh,t)),state:!!L(l,r,i,t)}),t.state||(t.nodes=null),R(l,r,i,t,t.binder),o.appendChild(t.placeholder)}}(),d=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return l(u(this,this.template,this.model,this.cntx)),void(this.$=j(this.elements));null==this.$&&(this.$=j(this.elements)),this.$[e?"hide":"show"]()}}};return function(n,t,r,i){var o=n.parent.components,l=o&&o[o.length-1];return n.template=n.nodes,n.placeholder=document.createComment(""),null==l||"%%"!==l.compoName||null==l.attr["if"]?void log_error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'):(l.onchange=e.refresh.bind(n),l.state&&(n.nodes=null),void i.appendChild(n.placeholder))}}(),f=function(){function n(e,n){var t=[];if(null==n||"object"!=typeof n||null==n.length)return t;for(var r,i=0,o=n.length;o>i;i++){switch(r=n[i],typeof r){case"string":case"number":case"boolean":r=n[i]=Object(r)}t[i]=new c(e.template,r,e)}return t}function t(e,n){for(var t=e.components,r=0,i=t.length,o=0,s=null,u=null,a=null,h=document.createDocumentFragment(),c=[];i>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)u=a.elements[o],u.parentNode.removeChild(u);e:for(o=0,s=n.length;s>o;o++){for(r=0;i>r;r++)if(n[o]===t[r].model){c[o]=t[r];continue e}log_warn("No Model Found for",n[o])}for(r=0,i=c.length;i>r;r++)if(a=c[r],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)u=a.elements[o],h.appendChild(u);e.components=c,l(h,e.placeholder)}function r(e,t,r,i,l){if(null!=t&&null!=r){var c=t,d=t+r;for(d>e.components.length&&(d=e.components.length);d>c;c++)a(e.components[c],e)&&(c--,d--)}if(null!=i&&l&&l.length){var f=new o,p=n(e,l),g=u(f,p),m=f.components;s(e,i,g),h(f),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[i,0].concat(m))}}function i(e,n){for(var t,r=e.components,i=r.length;--i>-1;)t=r[i],-1!==n.indexOf(t.model)&&a(t,e)}var o=e.Dom.Component,c=function(){function e(e,n,t){this.nodes=e,this.model=n,this.parent=t}var n=o.prototype;e.prototype={compoName:"%%.each.item",constructor:d,renderEnd:function(e){this.elements=e}};for(var t in n)e.prototype[t]=n[t];return e}(),d={append:function(n){var t=new c(this.template,n,this);e.render(t,n,null,this.container,this)}},f={refresh:function(e,o,s,c){var d,f,p=0;if(null==o){if(null!=this.components)for(p=0,f=this.components.length;f>p;p++)d=this.components[p],a(d,this)&&(p--,f--);return this.components=[],this.nodes=n(this,e),l(u(this,this.nodes),this.placeholder),void F(this.components,h)}for(f=e.length;f>p;p++)switch(d=e[p],typeof d){case"string":case"number":case"boolean":e[p]=Object(d)}switch(o){case"push":r(this,null,null,e.length,e.slice(e.length-1));break;case"pop":r(this,e.length,1);break;case"unshift":r(this,null,null,0,e.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var g=s[0],m=1===s.length?this.components.length:s[1],v=s.length>2?e.slice(s[0],s.length-2+s[0]):null;r(this,g,m,g,v);break;case"sort":case"reverse":t(this,e);break;case"remove":null!=c&&c.length&&i(this,c)}},dispose:function(){W(this.expr,this.model,this,this.refresh)}};return function(e,t,r,i){null==e.nodes&&"undefined"!=typeof Compo&&Compo.ensureTemplate(e);var o=e.attr.each||e.attr.foreach,l=L(o,t,r,e);w(e,{expr:o,binder:U(o,t,r,e,f.refresh.bind(e)),template:e.nodes,container:i,placeholder:document.createComment(""),dispose:f.dispose}),i.appendChild(e.placeholder),R(e.expr,t,r,e,e.binder);for(var s in d)e[s]=d[s];e.nodes=n(e,l)}}(),p=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=L(this.expr,this.model,this.cntx,this),n=0,t=this.elements.length;t>n;n++)this.elements[n].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){W(this.expr,this.model,this,this.binder)}};return function(n,t,r){var i=n.attr.visible;w(n,{expr:i,binder:U(i,t,r,n,e.refresh.bind(n)),dispose:e.dispose}),R(i,t,r,n,n.binder),e.refresh.call(n)}}();n.prototype={constructor:n,elements:null,renderStart:function(e,n,i){var l=this.attr;if(null==l["debugger"])return null!=l.use?void t(this,e,n,i):null!=l.log?void r(this,e,n,i):(this.model=e,null!=l["if"]?void o(this,e,n,i):null!=l["else"]?void d(this,e,n,i):void((null!=l.each||null!=l.foreach)&&f(this,e,n,i)))},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&p(this,this.model,this.cntx)}}}(n),function(){var e,r,o,u,c,d=n.getStatement();!function(){e=function(e,n,t,r,i){return d[e].getNodes(n,t,r,i)},r=function(e,n,t,r,i,o){if(null==e)return null;var l=[];return N(e,n,t,r,i,l),null==o?l:(arr_pushMany(o,l),l)},o=function(e,n){e.placeholder=document.createComment(""),n.appendChild(e.placeholder)},u=function(e,n,r,i,o,l){e.parent=l,e.model=r,e.refresh=t(e.refresh,e),e.binder=U(e.expr,r,i,l,e.refresh),R(e.expr,r,i,l,e.binder)},c=function(e,n){if(null!=e)for(var t,r="function"==typeof e.splice,i=r?e.length:1,o=-1;++o<i;)t=r?e[o]:e,t.style.display=n?"":"none"}}(),function(){function i(){}function o(e,n,r,i,o,l,s,u){for(e.model=o,e.ctx=l,e.controller=u,e.refresh=t(e.refresh,e),e.binder=z(e.refresh),e.index=r,e.Switch=[{node:n,elements:null}],R(n.expression,o,l,u,e.binder);;){if(n=n.nextSibling,null==n||"else"!==n.tagName)break;e.Switch.push({node:n,elements:null}),n.expression&&R(n.expression,o,l,u,e.binder)}null!=r&&(e.Switch[r].elements=i)}n.registerHandler("+if",{$meta:{serializeNodes:!0},render:function(n,t,i,o,l){for(var s=this,u=e("if",s,n,t,o),a=0,h=s;;){if(h.nodes===u)break;if(a++,h=s.nextSibling,null==h||"else"!==h.tagName){a=null;break}}return this.attr["switch-index"]=a,r(u,n,t,i,o,l)},renderEnd:function(e,n,t,r,l){var s=new i,u=this.attr["switch-index"];return s.placeholder=document.createComment(""),r.appendChild(s.placeholder),o(s,this,u,e,n,t,r,l),s},serializeNodes:function(e){for(var t=[e];;){if(e=e.nextSibling,null==e||"else"!==e.tagName)break;t.push(e)}return n.stringify(t)}}),i.prototype={compoName:"+if",ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(){for(var e,t=this,r=t.Switch,i=r.length,o=-1,s=t.index,u=t.model,a=t.ctx,h=t.controller;++o<i&&(e=r[o].node.expression,null!=e)&&!L(e,u,a,h););if(s!==o){if(null!=s&&c(r[s].elements,!1),o===i)return void(t.index=null);this.index=o;var d=r[o];if(null!=d.elements)return void c(d.elements,!0);var f=n.render(d.node.nodes,u,a,null,h),p=f.nodeType===Node.DOCUMENT_FRAGMENT_NODE?$.call(f.childNodes):f;l(f,t.placeholder),d.elements=p}},dispose:function(){for(var e,n,t=this.Switch,r=t.length,i=-1;++i<r;)e=t[i],n=e.node.expression,n&&W(n,this.model,this.controller,this.binder),e.node=null,e.elements=null;this.controller=null,this.model=null,this.ctx=null}}}(),function(){function e(){}function i(e,n,t,r,i){if(u=h.getNodes(e,n,t,r,i),a=null,null!=u){for(var o=n.length,l=-1;++l<o&&n[l].nodes!==u;);a=l===o?null:l}}function s(e,n,r,i,o,l,s,u){e.ctx=l,e.expr=n.expression,e.model=o,e.controller=u,e.index=r,e.nodes=n.nodes,e.refresh=t(e.refresh,e),e.binder=U(e.expr,o,l,u,e.refresh),e.Switch=new Array(n.nodes.length),null!=r&&(e.Switch[r]=i),R(n.expression,o,l,u,e.binder)}var u,a,h=d["switch"],f="switch-index";n.registerHandler("+switch",{$meta:{serializeNodes:!0},serializeNodes:function(e){return n.stringify(e)},render:function(e,n,t,o,l){var s=L(this.expression,e,n,o);return i(s,this.nodes,e,n,o),null==u?null:(this.attr[f]=a,r(u,e,n,t,o,l))},renderEnd:function(n,t,r,i,l){var u=new e,a=this.attr[f];return o(u,i),s(u,this,a,n,t,r,i,l),u}}),e.prototype={compoName:"+switch",ctx:null,model:null,controller:null,index:null,nodes:null,Switch:null,binder:null,refresh:function(e){var t=this,r=t.Switch,o=(r.length,t.index),s=t.model,h=t.ctx,d=t.controller;if(i(e,t.nodes,s,h,d),a!==o){if(null!=o&&c(r[o],!1),null==a)return void(t.index=null);this.index=a;var f=r[a];if(null!=f)return void c(f,!0);var p=n.render(u,s,h,null,d),g=p.nodeType===Node.DOCUMENT_FRAGMENT_NODE?$.call(p.childNodes):p;l(p,t.placeholder),r[a]=g}},dispose:function(){W(this.expr,this.model,this.controller,this.binder),this.controller=null,this.model=null,this.ctx=null;var e,n,t,r,i=this.Switch;for(e in i)if(n=i[e],null!=n)for(r=n.length,t=-1;++t<r;)null!=n[t].parentNode&&n[t].parentNode.removeChild(n[t])}}}(),function(){function e(e){this.expr=e.expression,this.nodes=e.nodes}function r(e,n,t,r,i){var o=[];return N(e,n,t,r,i,o),o}d["with"];n.registerHandler("+with",{$meta:{serializeNodes:!0},render:function(e,n,t,i){var o=L(this.expression,e,n,i);return r(this.nodes,o,n,t,i)},renderEnd:function(n,r,i,l,s){var u=new e(this);return u.elements=n,u.model=r,u.parent=s,u.refresh=t(u.refresh,u),u.binder=U(u.expr,r,i,s,u.refresh),R(u.expr,r,i,s,u.binder),o(u,l),u}}),e.prototype={compoName:"+with",elements:null,binder:null,model:null,parent:null,refresh:function(e){if(i(this.elements),this.components){for(var n=this.components.length,t=-1;++t<n;)Compo.dispose(this.components[t]);this.components.length=0}var o=document.createDocumentFragment();this.elements=r(this.nodes,e,null,o,this),l(o,this.placeholder),h(this)},dispose:function(){W(this.expr,this.model,this.parent,this.binder),this.parent=null,this.model=null,this.ctx=null}}}(),function(){function e(e){for(var n,t=e.length,r=-1;++r<t;)switch(n=e[r],typeof n){case"string":case"number":case"boolean":e[r]=Object(n)}}function t(e,n){for(var t=e.node.components,r=0,i=t.length,o=0,s=null,u=null,a=null,h=document.createDocumentFragment(),c=[];i>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)u=a.elements[o],u.parentNode.removeChild(u);e:for(o=0,s=n.length;s>o;o++){for(r=0;i>r;r++)if(n[o]===e._getModel(t[r])){c[o]=t[r];continue e}log_warn("No Model Found for",n[o])}for(r=0,i=c.length;i>r;r++)if(a=c[r],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)u=a.elements[o],h.appendChild(u);e.components=e.node.components=c,l(h,e.placeholder)}function r(e,n,t,r,i){var o=e.node,l=o.components;null==l&&(l=o.components=[]);var u=(e.prop1,e.prop2,e.type,e.ctx),h=e.node;if(null!=n&&null!=t){var c=n,d=n+t;for(d>l.length&&(d=l.length);d>c;c++)a(l[c],o)&&(c--,d--)}if(null!=r&&i&&i.length){var f,c=l.length,p=e._build(o,i,u,h),g=l.splice(c);for(s(o,r,p,e.placeholder),l.splice.apply(l,[r,0].concat(g)),c=0,f=g.length;f>c;c++)E.signal.emitIn(g[c],"domInsert")}}function i(e,n){for(var t,r=e.components,i=r.length;--i>-1;)t=r[i],-1!==n.indexOf(t.model)&&a(t,e.node)}var o={model:null,parent:null,refresh:function(n,o,s,u){var c,d=0,f=this.node,p=(this.model,this.ctx),g=this.node;if(null==o){var m=f.components;if(null!=m){for(var c=m.length,d=-1;++d<c;)a(m[d],f)&&(d--,c--);m.length=0}var v=this._build(f,n,p,g);return l(v,this.placeholder),void F(f.components,h)}var b=n;switch(e(n),o){case"push":r(this,null,null,b.length-1,b.slice(b.length-1));break;case"pop":r(this,b.length,1);break;case"unshift":r(this,null,null,0,b.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var _=s[0],y=1===s.length?this.components.length:s[1],x=s.length>2?b.slice(s[0],s.length-2+s[0]):null;r(this,_,y,_,x);break;case"sort":case"reverse":t(this,b);break;case"remove":null!=u&&u.length&&i(this,u)}},dispose:function(){W(this.expr,this.model,this.parent,this.binder)}};!function(){function t(e,n){this.prop1=n[i],this.prop2=n[l],this.type=n[s],this.expr=n[a],null==e.components&&(e.components=[]),this.node=e,this.components=e.components}var r=d["for"],i="for-prop-1",l="for-prop-2",s="for-type",a="for-expr";n.registerHandler("+for",{$meta:{serializeNodes:!0},serializeNodes:function(e){return n.stringify(e)},render:function(n,t,o,u,h){var c=r.parseFor(this.expression),d=this.attr;d[i]=c[0],d[l]=c[1],d[s]=c[2],d[a]=c[3];var f=L(c[3],n,t,u);null!=f&&(I(f)&&e(f),r.build(f,c,this.nodes,n,t,o,this,h))},renderEnd:function(e,n,r,i,o){var l=new t(this,this.attr);return l.placeholder=document.createComment(""),i.appendChild(l.placeholder),u(l,this,n,r,i,o),l},getHandler:function(e,n){return r.getHandler(e,n)}}),t.prototype={compoName:"+for",model:null,parent:null,refresh:o.refresh,dispose:o.dispose,_getModel:function(e){return e.scope[this.prop1]},_build:function(e,n,t,i){var o=r.getNodes(e.nodes,n,this.prop1,this.prop2,this.type);return N(o,this.model,t,null,i)}}}(),function(){function t(e,n,t,r,o,l){for(var s,u=n.length,a=-1;++a<u;)s=i.createItem(a,e,o),N(s,n[a],t,r,o,l)}function r(e){this.expr=e.expression,this.nodes=e.nodes,null==e.components&&(e.components=[]),this.node=e,this.components=e.components
}var i=d.each;n.registerHandler("+each",{render:function(n,r,i,o,l){var s=this,u=L(s.expression,n,r,o);null!=u&&(e(u),t(s.nodes,u,r,i,s,l))},renderEnd:function(e,n,t,i,o){var l=new r(this,this.attr);return l.placeholder=document.createComment(""),i.appendChild(l.placeholder),u(l,this,n,t,i,o),l}}),r.prototype={compoName:"+each",refresh:o.refresh,dispose:o.dispose,_getModel:function(e){return e.model},_build:function(e,n,r,i){var o=document.createDocumentFragment();return t(e.nodes,n,r,o,i),o}}}()}()}()}(window,mask);
//# sourceMappingURL=binding.min.js.map