(function(t,n){"use strict";function e(t,n){for(var e=0,i=n.length-1;i>e;e++){var r=n.shift();null==t[r]&&(t[r]={}),t=t[r]}return t}function i(t,n){if(null==n)return t;null==t&&(t={});for(var e in n)t[e]=n[e];return t}function r(t,n){for(var e=n.split("."),i=e.length,r=0;i>r;r++){if(null==t)return null;t=t[e[r]]}return t}function s(t,n,e){for(var i=n.split("."),r=i.length,s=0,o=null;r-1>s;s++)o=i[s],null==t[o]&&(t[o]={}),t=t[o];t[i[s]]=e}function o(t,n,i){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{},enumerable:!1});var r=t.__observers[n]||(t.__observers[n]=[]),s=n.split("."),o=s.length>1?e(t,s):t,a=s[0],l=o[a];r.push(i),Object.defineProperty(o,a,{get:function(){return l},set:function(t){l=t;for(var n=0,e=r.length;e>n;n++)r[n](t)}})}function a(t,n){function e(e){t[e]=function(){Array.prototype[e].apply(this,arguments),n(this,e,arguments)}}Object.defineProperty(t,"hasObserver",{value:!0,enumerable:!1,writable:!1});for(var i=0,r=["push","unshift","splice","pop","shift","reverse","sort"],s=r.length;s>i;i++)e(r[i])}function l(t,n,e){return"function"==typeof p?(p(t).on(n,e),void 0):null!=t.addEventListener?(t.addEventListener(n,e,!1),void 0):(t.attachEvent&&t.attachEvent("on"+n,e),void 0)}function d(){}function u(){}function h(t,n,e,r){if(this.constructor==h){var s=e.attr.bindingProvider||n.tagName.toLowerCase();if(m[s]instanceof Function)return new m[s](t,n,e);i(this,m[s])}return null==r&&(r=":bind"===e.compoName?"single":"dual"),this.node=e,this.model=t,this.element=n,this.property=e.attr.property||("single"===r?"element.innerHTML":"element.value"),this.setter=e.attr.setter,this.getter=e.attr.getter,this.dismiss=0,o(t,e.attr.value,this.objectChanged.bind(this)),"single"!==r&&l(n,e.attr.changeEvent||"change",this.domChanged.bind(this)),this.objectChanged(),this}function c(){}function f(){}function v(t,n){if(null==n&&(n=[]),null==t.components)return n;for(var e,i=t.components,r=0,s=i.length;s>r;r++)e=i[r],"validate"!==e.compoName?v(e):n.push(e);return n}function g(t,n){return null==t?null:"function"==typeof t[n]?t[n].bind(t):g(t.parent,n)}var p=window.jQuery||window.Zepto||window.$;null==p&&console.warn("Without jQuery/Zepto etc. binder is limited (mouse dom event bindings)"),n.registerHandler(":visible",d),d.prototype={constructor:d,refresh:function(t,e){e.style.display=n.Util.Condition.isCondition(this.attr.check,t)?"":"none"},render:function(t,e,i){this.refresh(t,e),this.attr.bind&&o(t,this.attr.bind,this.refresh.bind(this,t,e)),this.firstChild&&n.render(this.firstChild,t,e,i)}},n.registerHandler(":bind",u),u.prototype.render=function(t,e,i){null!=this.firstChild&&n.render(this.firstChild,t,e,i),new h(t,e,this,"single")},n.registerUtility("bind",function(t,n,e,i,s,a){var l=r(n,t);switch(e){case"node":var d=document.createTextNode(l);return o(n,t,function(t){d.textContent=t}),d;case"attr":return o(n,t,function(t){var n=s.getAttribute(a);s.setAttribute(a,n.replace(l,t)),l=t}),l}return console.error("Unknown binding type",arguments),"Unknown"});var m={};n.registerBinding=function(t,n){m[t]=n},n.BindingProvider=h,h.prototype={constructor:h,objectChanged:function(t){this.dismiss-->0||(null==t&&(t=this.objectWay.get(this.model,this.node.attr.value)),this.domWay.set(this,t),t instanceof Array&&t.hasObserver!==!0&&a(t,this.objectChanged.bind(this)))},domChanged:function(){var t=this.domWay.get(this);if(this.node.validations)for(var n,e=0,i=this.node.validations.length;i>e;e++)if(n=this.node.validations[e],n.validate(t,this.element,this.objectChanged.bind(this))===!1)return;this.dismiss=1,this.objectWay.set(this.model,this.node.attr.value,t),this.dismiss=0},objectWay:{get:function(t,e){return":"===e[0]?n.Util.ConditionUtil.condition(e.substring(1)):r(t,e)},set:function(t,n,e){s(t,n,e)}},domWay:{get:function(t){return t.getter?t.node.parent[t.getter]():r(t,t.property)},set:function(t,n){t.setter?t.node.parent[t.setter](n):s(t,t.property,n)}}},n.registerHandler(":dualbind",c),c.prototype.render=function(t,e,i){if(this.firstChild&&n.render(this.firstChild,t,e,i),i.components)for(var r,s=0,o=i.components.length;o>s;s++)r=i.components[s],":validate"==r.compoName&&(this.validations||(this.validations=[])).push(r);new h(t,e,this)},function(){function t(){}function e(t,n,e){console.warn("Validate Notification:",t,n);var i=p(t).next(".-validate-invalid");0===i.length&&(i=p("<div>").addClass("-validate-invalid").html("<span></span><button>cancel</button>").insertAfter(t)),i.children("button").off().on("click",function(){i.hide(),e&&e()}).end().children("span").text(n).end().show()}function i(t){p(t).next(".-validate-invalid").hide()}n.registerValidator=function(t,n){s[t]=n},n.registerHandler(":validate",t),t.prototype={constructor:t,render:function(t,n){this.element=n,this.model=t},validate:function(t,n,s){null==n&&(n=this.element),this.attr.getter&&(t=r({node:this,element:n},this.attr.getter)),null==this.validators&&this.initValidators();for(var o,a=0,l=this.validators.length;l>a;a++)if(o=this.validators[a],o.validate(this,t)===!1)return e(n,this.message,s),!1;return i(n),!0},initValidators:function(){this.validators=[],this.message=this.attr.message,delete this.attr.message;for(var t in this.attr)if(t in s!=!1){var n=s[t];"function"==typeof n&&(n=new n(this)),this.validators.push(n)}else console.error("Unknown Validator:",t,this)}};var s={match:{validate:function(t,n){return RegExp(t.attr.match).test(n)}},unmatch:{validate:function(t,n){return!RegExp(t.attr.unmatch).test(n)}},minLength:{validate:function(t,n){return n.length>=parseInt(t.attr.minLength,10)}},maxLength:{validate:function(t,n){return n.length<=parseInt(t.attr.maxLength,10)}},check:{validate:function(){}}}}(),n.registerHandler(":validate:group",f),f.prototype={constructor:f,render:function(t,e,i){this.firstChild&&n.render(this.firstChild,t,e,i)},validate:function(){for(var t,n=v(this),e=0,i=n.length;i>e;e++)if(t=n[e],!t.validate())return!1;return!0}},n.registerAttrHandler("x-on",function(t,n,e,i,r){for(var s,o=e.split(";"),a=0,d=o.length;d>a;a++){s=o[a];var u=s.substring(0,s.indexOf(":")),h=s.substring(s.indexOf(":")+1).trim(),c=g(r,h);c&&l(i,u,c)}})})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);