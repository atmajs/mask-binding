UTest({
	
	'+with' () {
		
		var ctr = {},
			model = {
				user: {
					name: 'Foo'
				}
			},
			
			template = `
				div >
					+with (user) {
						span > '~[name]';
					}
			`
			;
		var $dom = $render(template, model, null, null, ctr);
		var With = Compo.find(ctr, '+with');
		
		notEq_(With, null);
		$dom.eq_('text', 'Foo');
		
		model.user = { name: 'Bar' };
		
		$dom.eq_('text', 'Bar');
	},
	
	// Backend
	'$config': {
		'http.include': '/test/node.libraries.js'
	},
	
	'+with - backend' (done) {
		var template = `
			#container {
				+with (user) {
					span > '~[username]'
				}
			}
		`,
		model = {
			user: {
				username: 'Baz'
			}
		};
		
		UTest
			.server	
			.render(template, model)
			.done(function(doc, win){
				var $dom = $(doc);
				
				notEq_(win.app, null);
				eq_(win.app.components.length, 1);
				eq_(win.app.model.__observers.user.length, 1);
				eq_(win.app.model.user.username, 'Baz');
				
				$dom
					.find('#container')
					.eq_('length', 1)
					.eq_('text', 'Baz')
					;
				
				'> refresh'
				win.app.model.user = {
					username: 'Qux'
				};
				
				$dom
					.find('#container')
					.eq_('text', 'Qux')
					;
				
				'> dispose'
				win.app.remove();
				$dom
					.find('#container')
					.eq_('text', '')
					;
				
				eq_(win.app.model.__observers.user.length, 0);
				done();
			})
	}
	
})