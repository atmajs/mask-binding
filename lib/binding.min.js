(function(e,t){"use strict";function n(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.splice}function i(e){if(null==e)return!1;for(var t,n=0,i=e.length,r=1,o=arguments.length,s=0;i>n;n++)for(t=e[n],r=1;o>r;r++)if(arguments[r]===t){e.splice(n,1),n--,i--,s++;break}return s+1===o}function r(e,t){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var n=e.__observers.__array;if(null==n&&(n=e.__observers.__array=[]),0===n.length)for(var i,r,o=0,s=["push","unshift","splice","pop","shift","reverse","sort","remove"],l=s.length;l>o;o++)r=s[o],i=e[r],null!=i&&(e[r]=a(e,i,r));n[n.length++]=t}function o(e,t){var n=e.__observers&&e.__observers.__array;if(null!=n)for(var i=0,r=n.length;r>i;i++)if(n[i]===t){n[i]=null;for(var o=i;r>o;o++)n[o]=n[o+1];r--,n.length--}}function s(e){null!=e.__observers&&(e.__observers.__dirty=!1)}function l(e){var t=e.__observers,n=t&&t.__array;if(null!=n&&t.__dirty===!0){for(var i,r=0,o=n.length;o>r;r++)i=n[r],"function"==typeof i&&i(e);t.__dirty=null}}function a(e,t,n){return function(){return u(e,t,n,D.call(arguments))}}function u(e,t,n,i){var r=e.__observers&&e.__observers.__array,o=t.apply(e,i);if(null==r||0===r.length)return o;if(null!=e.__observers.__dirty)return e.__observers.__dirty=!0,o;for(var s,l=0,a=r.length;a>l;l++)s=r[l],"function"==typeof s&&s(e,n,i,o);return o}function h(e,t){for(var n=0,i=e.length;i>n;n++)t(e[n])}function c(e){return e.parentNode.removeChild(e)}function f(e){if(null!=e)for(var t=0,n=e.length;n>t;t++)c(e[t])}function d(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function p(e,t){return t.parentNode.insertBefore(e,t)}function v(e,t,n){if(null==e.components)return d(n,e.placeholder);for(var i,r=e.components,o=null,s=!0,l=r.length,a=t;l>a;a++)if(i=r[a].elements,i&&i.length){o=i[0];break}if(null==o)for(s=!1,a=l>t?t:l;--a>-1;)if(i=r[a].elements,i&&i.length){o=i[i.length-1];break}return null==o&&(o=e.placeholder),s?p(n,o):d(n,o)}function g(e,n,i,r,o){return t.render(n,i,r,o,e)}function m(e,t){if(null==e)return!1;f(e.elements),e.elements=null,null!=M&&M.dispose(e);var n=t&&t.components||e.parent&&e.parent.components;return null==n?(console.error("Parent Components Collection is undefined"),!1):i(n,e)}function b(e){null!=M&&M.signal.emitIn(e,"domInsert")}function y(e,t){if("function"==typeof e.dispose){var n=e.dispose;return e.dispose=function(){t.call(this),n.call(this)},void 0}e.dispose=t}function _(e,t,i,o,s){if("."===e)return n(t)&&r(t,s),void 0;var l,a=Q(e),u=X(a);if(null!=u){if("string"==typeof u)return B(t,u)&&(l=t),null==l&&B(o,u)&&(l=o),null==l&&(l=t),I(l,u,s),void 0;for(var h,c=null!=u.length&&"function"==typeof u.splice,f=c===!0?u.length:1,d=0;f>d;d++)if(h=c?u[d]:u,null!=h){if("object"==typeof h){if(l=G(h.accessor,t,i,o),null==l||"object"!=typeof l){console.error("Binding failed to an object over accessor",h);continue}h=h.ref}else l=B(t,h)?t:B(o,h)?o:t;I(l,h,s)}}}function x(e,t,n,i){if("function"==typeof n&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===e)return o(t,i),void 0;var r,s=X(e);if(null!=s){if("string"==typeof s)return B(t,s)&&P(t,s,i),B(n,s)&&P(n,s,i),void 0;for(var r,l=null!=s.length&&"function"==typeof s.splice,a=l===!0?s.length:1,u=0;a>u;u++)if(r=l?s[u]:s,null!=r)if("object"!=typeof r)B(t,r)&&P(t,r,i),B(n,r)&&P(n,r,i);else{var h=G(r.accessor,t,null,n);h&&P(h,r.ref,i)}}}function C(e,t,n,i,r){var o=0;return function(){if(o++>10)return console.warn("Concurent binder detected",e),void 0;var s=K(e,t,n,i);if(arguments.length>1){var l=D.call(arguments);l[0]=s,r.apply(this,l)}else r(s);o--}}function k(e,t,n){for(var i,r,o,s,l=e.split(";"),a=[],u=0,h=l.length;h>u;u++)i=l[u].split(":"),1===i.length||2===i.length?(o=2==i.length?i[0]:n,r=i[2==i.length?1:0],s=j(r.trim(),o,t),null!=s&&a.push(s)):console.error('Too much ":" in a signal def.',l[u]);return a}function j(e,t,n){if(n!==!0)return{signal:e,type:t};var i=e.indexOf(".");return-1===i?(console.error("No pipe name in a signal",e),null):{signal:e.substring(i+1),pipe:e.substring(0,i),type:t}}function w(){}function E(){}function N(){}function O(e,t){if(null==t&&(t=[]),null==e.components)return t;for(var n,i=e.components,r=0,o=i.length;o>r;r++)n=i[r],"validate"!==n.compoName?O(n):t.push(n);return t}var S,T,I,P,$,V,A,B,L=e.jQuery||e.Zepto||e.$,M="undefined"!=typeof Compo?Compo:t.Compo||e.Compo,W=M.Dom.addEventListener,R=t.registerHandler,F=t.registerAttrHandler,H=t.registerUtil,D=Array.prototype.slice;(function(){function e(e,t){for(var n,i=-1,r=t.length-1;r>++i;)n=t[i],null==e[n]&&(e[n]={}),e=e[n];return e}function t(t,i,o,s){var l=s.length,u=l>1?e(t,s):t,h=s[l-1],c=u[h];return l>1&&a(t,s),"length"===h&&n(u)?(r(u,function(e,t,n,i){for(var r=o.length,s=-1;r>++s;)o[s](e,t,n,i)}),c):(Object.defineProperty(u,h,{get:function(){return c},set:function(e){var t=0,s=o.length;if(e!==c){if(c=e,n(e))for(t=0;s>t;t++)r(e,o[t]);if(null!=o.__dirties)return o.__dirties[i]=1,void 0;for(t=0;s>t;t++)o[t](e)}},configurable:!0}),c)}function a(e,t){for(var n,i=h(e),r="",o=0,s=t.length-1;s>o;o++)n=t[o],r+=n+".",u(r,e,n,i),e=e[n]}function u(e,t,n,i){var r,o=t[n];Object.defineProperty(t,n,{get:function(){return o},set:function(t){t!==o&&(r=o,o=t,i(e,r))},configurable:!0})}function h(e){return function(t,n){var i=e.__observers;if(null!=i)for(var r in i)if(0===r.indexOf(t)){var o=i[r].slice(0),s=o.length,l=0;if(0!==s){var a,u,h=S(e,r);for(l=0;s>l;l++)a=o[l],P(e,r,a),u=r.substring(t.length),P(n,u,a);for(l=0;s>l;l++)o[l](h);for(l=0;s>l;l++)I(e,r,o[l])}}}}function c(e,t,n){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var i=e.__observers;return null!=i[t]?i[t].push(n):i[t]=[n],i[t]}S=function(e,t){for(var n=t.split("."),i=n.length,r=-1;i>++r;){if(null==e)return null;e=e[n[r]]}return e},T=function(e,t,n){for(var i,r=t.split("."),o=r.length-1,s=-1;o>++s;)i=r[s],null==e[i]&&(e[i]={}),e=e[i];e[r[s]]=n},I=function(e,i,o){for(var s=i.split("."),l=s.length,a=-1,u=e;l>++a&&(u=u[s[a]],null!=u);)if(null!=u.__observers){var h=s.slice(a).join(".");if(u.__observers[h])return u.__observers[h].push(o),c(e,i,o),void 0}var f=c(e,i,o);1===f.length&&t(e,i,f,s,!0);var d=S(e,i);n(d)&&r(d,o)},P=function(e,t,r){for(var s=t.split("."),l=s.length,a=-1,u=e;l>++a&&(u=u[s[a]],null!=u);)if(null!=u.__observers){P(u,s.slice(a).join("."),r);break}if(null!=e.__observers&&null!=e.__observers[t]){var h=S(e,t);if(2===arguments.length)return e.__observers[t].length=0,void 0;i(e.__observers[t],r),n(h)&&o(h,r)}},$=function(e){if(n(e))return s(e),void 0;var t=e.__observers;null!=t&&(t.__dirties={})},V=function(e){if(n(e))return l(e),void 0;var t=e.__observers,i=null==t?null:t.__dirties;if(null!=i){for(var r in i){var o=e.__observers[r],s=S(e,r);if(null!=o)for(var a=0,u=o.length;u>a;a++)o[a](s)}t.__dirties=null}},A=function(e,t){if(null==t)return e;null==e&&(e={});for(var n in t)e[n]=t[n];return e},B=function(e,t){if(null==e)return!1;for(var n=t.split("."),i=n.length,r=-1;i>++r;)if(null==(e=e[n[r]]))return!1;return!0}})();var U=t.Utils.Expression,G=U.eval,K=function(e,t,n,i){if("."===e)return t;var r=G(e,t,n,i);return null==r?"":r},Q=U.parse,X=U.varRefs,Z=function(){function e(e,t,n,i){null==i&&(i=":bind"===n.compoName?"single":"dual");var r,s=n.attr;if(this.node=n,this.controller=n,this.model=e,this.element=t,this.value=s.value,this.property=s.property,this.setter=s.setter,this.getter=s.getter,this.dismiss=0,this.bindingType=i,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(t.tagName){case"INPUT":if(r=t.getAttribute("type"),"checkbox"===r){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=o.SELECT;break;default:this.property="element.innerHTML"}if(s.log&&(this.log=!0,"log"!==s.log&&(this.logExpression=s.log)),s["x-signal"]){var l=k(s["x-signal"],null,"dom")[0],a=l&&l.type;switch(a){case"dom":case"object":this["signal_"+a+"Changed"]=l.signal;break;default:console.error("Signal typs is not supported",l)}}if(s["x-pipe-signal"]){var l=k(s["x-pipe-signal"],!0,"dom")[0],a=l&&l.type;switch(a){case"dom":case"object":this["pipe_"+a+"Changed"]=l;break;default:console.error("Pipe type is not supported")}}if(s["dom-slot"]){this.slots={};var u=n.parent,h=u.parent;u.parent=this,this.parent=h,this.slots[s["dom-slot"]]=function(e,t){this.domChanged(e,t)}}var c=s["object-pipe-slot"]||s["x-pipe-slot"];if(c){var f=c,d=f.indexOf("."),p=f.substring(0,d),l=f.substring(d+1);this.pipes={},this.pipes[p]={},this.pipes[p][l]=function(){this.objectChanged()},M.pipe.addController(this)}if(s.expression){if(this.expression=s.expression,null==this.value&&"single"!==i){var v=X(this.expression);"string"==typeof v?this.value=v:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function n(e){var t=e.expression,n=e.model,i=e.objectChanged=e.objectChanged.bind(e);if(e.binder=C(t,n,e.cntx,e.node,i),_(t,n,e.cntx,e.node,e.binder),"dual"===e.bindingType){var r=e.node.attr;if(!r["change-slot"]&&!r["change-pipe-event"]){var o=e.element,s=r["change-event"]||r.changeEvent||"change",l=e.domChanged.bind(e);W(o,s,l)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function i(e,t,n){var r=e.slots;(null==r||"function"!=typeof r[t]||r[t].apply(e,n)!==!1)&&null!=e.parent&&i(e.parent,t,n)}var r={};t.registerBinding=function(e,t){r[e]=t},t.BindingProvider=e,e.create=function(t,n,i,o){var s,l=i.attr.bindingProvider,a=null==l?null:r[l];return"function"==typeof a?new a(t,n,i,o):(s=new e(t,n,i,o),null!=a&&A(s,a),s)},e.bind=function(e){return n(e)},e.prototype={constructor:e,dispose:function(){x(this.expression,this.model,this.controller,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&i(this.node,this.signal_objectChanged,[e]),this.pipe_objectChanged){var t=this.pipe_objectChanged;M.pipe(t.pipe).emit(t.signal)}this.locked=!1}},domChanged:function(e,t){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var n=t||this.domWay.get(this),r=!0;if(this.node.validations)for(var o,s=0,l=this.node.validations.length;l>s;s++)if(o=this.node.validations[s],o.validate(n,this.element,this.objectChanged.bind(this))===!1){r=!1;break}if(r&&(this.dismiss=1,this.objectWay.set(this.model,this.value,n),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",n),this.signal_domChanged&&i(this.node,this.signal_domChanged,[n]),this.pipe_domChanged)){var a=this.pipe_domChanged;M.pipe(a.pipe).emit(a.signal)}this.locked=!1},objectWay:{get:function(e,t){return K(t,e.model,e.cntx,e.controller)},set:function(e,t,n){T(e,t,n)}},domWay:{get:function(e){if(e.getter){var t=e.node.parent;return null==t||"function"!=typeof t[e.getter]?(console.error("Mask.bindings: Getter should be a function",e.getter,e),null):t[e.getter]()}return S(e,e.property)},set:function(e,t){if(e.setter){var n=e.node.parent;if(null==n||"function"!=typeof n[e.setter])return console.error("Mask.bindings: Setter should be a function",e.setter,e),void 0;n[e.setter](t)}else T(e,e.property,t)}}};var o={SELECT:{get:function(e){var t=e.element;return-1===t.selectedIndex?"":t.options[t.selectedIndex].getAttribute("name")},set:function(e,t){for(var n,i=e.element,r=0,o=i.options.length;o>r;r++)if(n=i.options[r],n.getAttribute("name")==t)return i.selectedIndex=r,void 0}}};return A(e,{addObserver:I,removeObserver:P}),e}();R(":visible",w),w.prototype={constructor:w,refresh:function(e,t){t.style.display=K(this.attr.check,e)?"":"none"},renderStart:function(e,t,n){this.refresh(e,n),this.attr.bind&&I(e,this.attr.bind,this.refresh.bind(this,e,n))}},function(){function e(){}R(":bind",e),e.prototype={constructor:e,renderEnd:function(e,t,n,i){this.provider=Z.create(t,i,this,"single"),Z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),R(":dualbind",E),E.prototype={constructor:E,renderEnd:function(e,n,i,r){if(this.provider=Z.create(n,r,this),this.components)for(var o,s=0,l=this.components.length;l>s;s++)o=this.components[s],":validate"===o.compoName&&(this.validations||(this.validations=[])).push(o);if(!this.attr["no-validation"]&&!this.validations){var a=n.Validate,u=this.provider.value;if(null==a&&-1!==u.indexOf(".")){for(var h=u.split("."),s=0,c=h.length,f=n[h[0]];null==a&&c>++s&&f;)a=f.Validate,f=f[h[s]];u=h.slice(s).join(".")}var d=a&&a[u];"function"==typeof d&&(d=t.getHandler(":validate").createCustom(r,d),(this.validations||(this.validations=[])).push(d))}Z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function e(){}function n(e,t){this.fn=e,this.message=t}function i(e,t,n){console.warn("Validate Notification:",e,t);var i=L(e).next("."+o);return 0===i.length&&(i=L("<div>").addClass(o).html("<span></span><button>cancel</button>").insertAfter(e)),i.children("button").off().on("click",function(){i.hide(),n&&n()}).end().children("span").text(t).end().show()}function r(e){return L(e).next("."+o).hide()}var o="-validate-invalid";t.registerValidator=function(e,t){s[e]=t},R(":validate",e),e.prototype={constructor:e,attr:{},renderStart:function(t,i,r){if(this.element=r,this.attr.value){var o=e.resolveFromModel(t,this.attr.value);o&&(this.validators=[new n(o)])}},validate:function(e,t,n){null==t&&(t=this.element),this.attr&&(null==e&&this.attr.getter&&(e=S({node:this,element:t},this.attr.getter)),null==e&&this.attr.value&&(e=S(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var i,r=0,o=this.validators.length;o>r;r++)if(i=this.validators[r].validate(e),i&&!this.attr.silent)return this.notifyInvalid(t,i,n),!1;return this.makeValid(t),!0},notifyInvalid:function(e,t,n){return i(e,t,n)},makeValid:function(e){return r(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in s!=!1){var t=s[e];this.validators.push(new n(t(this.attr[e],this),this.attr.message))}else console.error("Unknown Validator:",e,this)}}},e.resolveFromModel=function(e,t){return S(e.Validate,t)},e.createCustom=function(t,i){var r=new e;return r.element=t,r.validators=[new n(i)],r},n.prototype.validate=function(e){var t=this.fn(e);return t===!1?this.message||"Invalid - "+e:t},R(":validate:message",Compo({template:"div."+o+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,t){var n=this;this.model.message=e,this.compos.button.off().on(function(){n.hide(),t&&t()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(e){return function(t){return RegExp(e).test(t)}},unmatch:function(e){return function(t){return!RegExp(e).test(t)}},minLength:function(e){return function(t){return t.length>=parseInt(e,10)}},maxLength:function(e){return function(t){return t.length<=parseInt(e,10)}},check:function(e,t){return function(n){return K("x"+e,t.model,{x:n},t)}}}}(),R(":validate:group",N),N.prototype={constructor:N,validate:function(){for(var e,t=O(this),n=0,i=t.length;i>n;n++)if(e=t[n],!e.validate())return!1;return!0}},function(){function e(e,t,n){return e?null==t||""===t?e+" "+n:e.replace(t,n):n}function t(t,n,i,r,o){return function(n){switch(t){case"node":i.textContent=n;break;case"attr":var s,l,a=typeof i[o];if("boolean"===a)return r=i[o]=!!n,void 0;if("string"===a)return r=i[o]=e(i[o],r,n),void 0;s=i.getAttribute(o),l=e(s,r,n),i.setAttribute(o,l),r=n}}}function n(e,n,i,r,o,s,l,a){var u=t(a,n,o,e,l),h=C(n,i,r,s,u);_(n,i,r,s,h),y(s,function(){x(n,i,s,h)})}H("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,t,n,i,r){var o=K(e,t,n,r);return this.element=document.createTextNode(o),this.current=o},node:function(e,t,i,r,o){return n(this.current,e,t,i,this.element,o,null,"node"),this.element},attrRenderStart:function(e,t,n,i,r){return this.current=K(e,t,n,r)},attr:function(e,t,i,r,o,s){return n(this.current,e,t,i,r,o,s,"attr"),this.current}})}(),F("xx-visible",function(e,t,n,i,r,o){var s=C(t,n,i,o,function(e){r.style.display=e?"":"none"});_(t,n,i,o,s),y(o,function(){x(t,n,o,s)}),K(t,n,i,o)||(r.style.display="none")}),F("x-toggle","client",function(e,t,n,i,r,o){var s=t.substring(0,t.indexOf(":")),l=t.substring(s.length+1),a=X(l);"string"!=typeof a&&(a=a[0]),W(r,s,function(){var e=K(l,n,i,o);T(n,a,e)})}),F("x-class-toggle","client",function(e,t,n,i,r){var o=t.substring(0,t.indexOf(":")),s=t.substring(o.length+1).trim();W(r,o,function(){L(r).toggleClass(s)})}),function(e){function t(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",t);var n=function(){var e={refresh:function(e){this.model=e,this.elements&&(f(this.elements),this.elements=[]),null!=M&&M.dispose(this),p(g(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){x(this.expr,this.originalModel,this,this.binder)}};return function(t,n,i,r){var o=t.attr.use;A(t,{expr:o,placeholder:document.createComment(""),binder:C(o,n,i,t,e.refresh.bind(t)),originalModel:n,model:K(o,n,i,t),dispose:e.dispose}),_(o,n,i,t,t.binder),r.appendChild(t.placeholder)}}(),i=function(){return function(e,t,n){function i(e){console.log("Logger > Key: %s, Value: %s",r,e)}var r=e.attr.log,o=C(r,t,n,e,i),s=K(r,t,n,e);_(r,t,n,e,o),y(e,function(){x(r,t,e,o)}),i(s)}}(),r=function(){function e(e,t){return function(){return e.apply(t,arguments)}}var t={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(p(g(this,this.template,this.model,this.cntx),this.placeholder),this.$=L(this.elements)):(null==this.$&&(this.$=L(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){x(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(n,i,r,o){var s=n.attr["if"];A(n,{expr:s,template:n.nodes,placeholder:document.createComment(""),binder:C(s,i,r,n,e(t.refresh,n)),state:!!K(s,i,r,n)}),n.state||(n.nodes=null),_(s,i,r,n,n.binder),o.appendChild(n.placeholder)}}(),o=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return p(g(this,this.template,this.model,this.cntx)),this.$=L(this.elements),void 0;null==this.$&&(this.$=L(this.elements)),this.$[e?"hide":"show"]()}}};return function(t,n,i,r){var o=t.parent.components,s=o&&o[o.length-1];return t.template=t.nodes,t.placeholder=document.createComment(""),null==s||"%%"!==s.compoName||null==s.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(s.onchange=e.refresh.bind(t),s.state&&(t.nodes=null),r.appendChild(t.placeholder),void 0)}}(),s=function(){function t(e,t){var n=[];if(null==t||"object"!=typeof t||null==t.length)return n;for(var i,r=0,o=t.length;o>r;r++){switch(i=t[r],typeof i){case"string":case"number":case"boolean":i=t[r]=Object(i)}n[r]=new s(e.template,i,e)}return n}function n(e,t){for(var n=e.components,i=0,r=n.length,o=0,s=null,l=null,a=null,u=document.createDocumentFragment(),h=[];r>i;i++)if(a=n[i],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)l=a.elements[o],l.parentNode.removeChild(l);e:for(o=0,s=t.length;s>o;o++){for(i=0;r>i;i++)if(t[o]===n[i].model){h[o]=n[i];continue e}console.warn("No Model Found for",t[o])}for(i=0,r=h.length;r>i;i++)if(a=h[i],null!=a.elements&&0!==a.elements.length)for(o=0,s=a.elements.length;s>o;o++)l=a.elements[o],u.appendChild(l);e.components=h,p(u,e.placeholder)}function i(e,n,i,r,s){if(null!=n&&null!=i){var l=n,a=n+i;for(a>e.components.length&&(a=e.components.length);a>l;l++)m(e.components[l],e)&&(l--,a--)}if(null!=r&&s&&s.length){var u=new o,h=t(e,s),c=g(u,h),f=u.components;v(e,r,c),b(u),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[r,0].concat(f))}}function r(e,t){for(var n,i=e.components,r=i.length;--r>-1;)n=i[r],-1!==t.indexOf(n.model)&&m(n,e)}var o=e.Dom.Component,s=function(){function e(e,t,n){this.nodes=e,this.model=t,this.parent=n}var t=o.prototype;e.prototype={compoName:"%%.each.item",constructor:l,renderEnd:function(e){this.elements=e}};for(var n in t)e.prototype[n]=t[n];return e}(),l={append:function(t){var n=new s(this.template,t,this);e.render(n,t,null,this.container,this)}},a={refresh:function(e,o,s,l){var a,u,c=0;if(null==o){if(null!=this.components)for(c=0,u=this.components.length;u>c;c++)a=this.components[c],m(a,this)&&(c--,u--);return this.components=[],this.nodes=t(this,e),p(g(this,this.nodes),this.placeholder),h(this.components,b),void 0}for(u=e.length;u>c;c++)switch(a=e[c],typeof a){case"string":case"number":case"boolean":e[c]=Object(a)}switch(o){case"push":i(this,null,null,e.length,e.slice(e.length-1));break;case"pop":i(this,e.length,1);break;case"unshift":i(this,null,null,0,e.slice(0,1));break;case"shift":i(this,0,1);break;case"splice":var f=s[0],d=1===s.length?this.components.length:s[1],v=s.length>2?e.slice(s[0],s.length-2+s[0]):null;i(this,f,d,f,v);break;case"sort":case"reverse":n(this,e);break;case"remove":null!=l&&l.length&&r(this,l)}},dispose:function(){x(this.expr,this.model,this,this.refresh)}};return function(e,n,i,r){null==e.nodes&&"undefined"!=typeof Compo&&Compo.ensureTemplate(e);var o=e.attr.each||e.attr.foreach,s=K(o,n,i,e);A(e,{expr:o,binder:C(o,n,i,e,a.refresh.bind(e)),template:e.nodes,container:r,placeholder:document.createComment(""),dispose:a.dispose}),r.appendChild(e.placeholder),_(e.expr,n,i,e,e.binder);for(var u in l)e[u]=l[u];e.nodes=t(e,s)}}(),l=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=K(this.expr,this.model,this.cntx,this),t=0,n=this.elements.length;n>t;t++)this.elements[t].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){x(this.expr,this.model,this,this.binder)}};return function(t,n,i){var r=t.attr.visible;A(t,{expr:r,binder:C(r,n,i,t,e.refresh.bind(t)),dispose:e.dispose}),_(r,n,i,t,t.binder),e.refresh.call(t)}}();t.prototype={constructor:t,elements:null,renderStart:function(e,t,l){var a=this.attr;return null==a["debugger"]?null!=a.use?(n(this,e,t,l),void 0):null!=a.log?(i(this,e,t,l),void 0):(this.model=e,null!=a["if"]?(r(this,e,t,l),void 0):null!=a["else"]?(o(this,e,t,l),void 0):((null!=a.each||null!=a.foreach)&&s(this,e,t,l),void 0)):void 0},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&l(this,this.model,this.cntx)}}}(t)})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);