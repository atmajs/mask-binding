(function(e,n){"use strict";function t(e,n){return function(){return e.apply(n,arguments)}}function r(e){return e.parentNode.removeChild(e)}function i(e){if(null!=e)for(var n=0,t=e.length;t>n;n++)r(e[n])}function o(e,n){return n.parentNode.insertBefore(e,n.nextSibling)}function s(e,n){return n.parentNode.insertBefore(e,n)}function l(e,n,t,r){if(null==e.components)return o(t,r||e.placeholder);for(var i,l=e.components,a=null,u=!0,c=l.length,h=n;c>h;h++)if(i=l[h].elements,i&&i.length){a=i[0];break}if(null==a)for(u=!1,h=c>n?n:c;--h>-1;)if(i=l[h].elements,i&&i.length){a=i[i.length-1];break}return null==a&&(a=r||e.placeholder),u?s(t,a):o(t,a)}function a(e,t,r,i,o){return n.render(t,r,i,o,e)}function u(e,n){if(null==e)return!1;null!=e.elements&&(i(e.elements),e.elements=null),E.dispose(e);var t=n&&n.components||e.parent&&e.parent.components;return null==t?(console.error("Parent Components Collection is undefined"),!1):P(t,e)}function c(e){E.signal.emitIn(e,"domInsert")}function h(e,n){if("function"==typeof e.dispose){var t=e.dispose;return e.dispose=function(){n.call(this),t.call(this)},void 0}e.dispose=n}function f(){}function d(){}function p(){}function v(e,n){if(null==n&&(n=[]),null==e.components)return n;for(var t,r=e.components,i=0,o=r.length;o>i;i++)t=r[i],"validate"!==t.compoName?v(t):n.push(t);return n}var g,m,b,y,_,x,C,k,w,j=n.build,N=e.jQuery||e.Zepto||e.$,E="undefined"!=typeof Compo?Compo:n.Compo||e.Compo,S=E.Dom.addEventListener,O=n.registerHandler,T=n.registerAttrHandler,$=n.registerUtil,I=Array.prototype.slice;(function(){function e(e,n){for(var t,r=-1,i=n.length-1;i>++r;)t=n[r],null==e[t]&&(e[t]={}),e=e[t];return e}function n(n,r,i,o){var s=o.length,l=s>1?e(n,o):n,a=o[s-1],u=l[a];return s>1&&t(n,o),"length"===a&&M(l)?(B(l,function(e,n,t,r){for(var o=i.length,s=-1;o>++s;)i[s](e,n,t,r)}),u):(Object.defineProperty(l,a,{get:function(){return u},set:function(e){var n=0,t=i.length;if(e!==u){if(u=e,M(e))for(n=0;t>n;n++)B(e,i[n]);if(null!=i.__dirties)return i.__dirties[r]=1,void 0;for(n=0;t>n;n++)i[n](e)}},configurable:!0}),u)}function t(e,n){for(var t,o=i(e),s="",l=0,a=n.length-1;a>l;l++)t=n[l],s+=t+".",r(s,e,t,o),e=e[t]}function r(e,n,t,r){var i,o=n[t];Object.defineProperty(n,t,{get:function(){return o},set:function(n){n!==o&&(i=o,o=n,r(e,i))},configurable:!0})}function i(e){return function(n,t){var r=e.__observers;if(null!=r)for(var i in r)if(0===i.indexOf(n)){var o=r[i].slice(0),s=o.length,l=0;if(0!==s){var a,u,c=g(e,i);for(l=0;s>l;l++)a=o[l],_(e,i,a),u=i.substring(n.length),_(t,u,a);for(l=0;s>l;l++)o[l](c);for(l=0;s>l;l++)b(e,i,o[l])}}}}function o(e,n,t){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var r=e.__observers;return null!=r[n]?-1===V(r[n],t)&&r[n].push(t):r[n]=[t],r[n]}g=function(e,n){for(var t=n.split("."),r=t.length,i=-1;r>++i;){if(null==e)return null;e=e[t[i]]}return e},m=function(e,n,t){for(var r,i=n.split("."),o=i.length-1,s=-1;o>++s;)r=i[s],null==e[r]&&(e[r]={}),e=e[r];e[i[s]]=t},b=function(e,t,r){for(var i=t.split("."),s=i.length,l=-1,a=e;s>++l&&(a=a[i[l]],null!=a);)if(null!=a.__observers){var u=i.slice(l+1).join(".");if(a.__observers[u]){o(a,u,r);var c=o(e,t,r);if(1===c.length){var h=i.splice(0,l);0!==h.length&&n(e,t,c,h,!0)}return}}var c=o(e,t,r);1===c.length&&n(e,t,c,i,!0);var f=g(e,t);M(f)&&B(f,r)},y=function(e,n,t){for(var r=n.split("."),i=r.length,o=-1,s=e;i>++o&&(s=s[r[o]],null!=s);)if(null!=s.__observers){if(y(s,r.slice(o).join("."),t))return!0;break}var l=e.__observers;return null==l||null==l[n]?!1:-1!==V(l[n],t)},_=function(e,n,t){for(var r=n.split("."),i=r.length,o=-1,s=e;i>++o&&(s=s[r[o]],null!=s);)if(null!=s.__observers){_(s,r.slice(o).join("."),t);break}var l=e.__observers;if(null!=l&&null!=l[n]){var a=g(e,n);if(2===arguments.length)return l[n].length=0,void 0;P(l[n],t),M(a)&&F(a,t)}},x=function(e){if(M(e))return L(e),void 0;var n=e.__observers;null!=n&&(n.__dirties={})},C=function(e){if(M(e))return W(e),void 0;var n=e.__observers,t=null==n?null:n.__dirties;if(null!=t){for(var r in t){var i=e.__observers[r],o=g(e,r);if(null!=i)for(var s=0,l=i.length;l>s;s++)i[s](o)}n.__dirties=null}},k=function(e,n){if(null==n)return e;null==e&&(e={});for(var t in n)e[t]=n[t];return e},w=function(e,n){if(null==e)return!1;for(var t=n.split("."),r=t.length,i=-1;r>++i;)if(null==(e=e[t[i]]))return!1;return!0}})();var M,P,A,V,B,F,L,W;(function(){function e(e,t,r){return function(){return n(e,t,r,I.call(arguments))}}function n(e,n,t,r){var i=e.__observers&&e.__observers.__array,o=n.apply(e,r);if(null==i||0===i.length)return o;if(null!=e.__observers.__dirty)return e.__observers.__dirty=!0,o;for(var s,l=0,a=i.length;a>l;l++)s=i[l],"function"==typeof s&&s(e,t,r,o);return o}M=function(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.splice},P=function(e){if(null==e)return!1;for(var n,t=0,r=e.length,i=1,o=arguments.length,s=0;r>t;t++)for(n=e[t],i=1;o>i;i++)if(arguments[i]===n){e.splice(t,1),t--,r--,s++;break}return s+1===o},B=function(n,t){null==n.__observers&&Object.defineProperty(n,"__observers",{value:{__dirty:null},enumerable:!1});var r=n.__observers.__array;if(null==r&&(r=n.__observers.__array=[]),0===r.length)for(var i,o,s=0,l=["push","unshift","splice","pop","shift","reverse","sort","remove"],a=l.length;a>s;s++)o=l[s],i=n[o],null!=i&&(n[o]=e(n,i,o));r[r.length++]=t},F=function(e,n){var t=e.__observers&&e.__observers.__array;if(null!=t)for(var r=0,i=t.length;i>r;r++)if(t[r]===n){t[r]=null;for(var o=r;i>o;o++)t[o]=t[o+1];i--,t.length--}},L=function(e){null!=e.__observers&&(e.__observers.__dirty=!1)},W=function(e){var n=e.__observers,t=n&&n.__array;if(null!=t&&n.__dirty===!0){for(var r,i=0,o=t.length;o>i;i++)r=t[i],"function"==typeof r&&r(e);n.__dirty=null}},A=function(e,n){for(var t=0,r=e.length;r>t;t++)n(e[t])},V=function(e,n){return e.indexOf(n)}})();var D,R,H,U,G,K,Q;(function(){var e=n.Utils.Expression,t=e.eval;K=e.parse,Q=e.varRefs,D=function(e,n,r,i){if("."===e)return n;var o=t(e,n,r,i);return null==o?"":o},R=function(e,n,r,i,o){if("."===e)return M(n)&&B(n,o),void 0;var s,l=K(e),a=Q(l);if(null!=a){if("string"==typeof a)return w(n,a)&&(s=n),null==s&&w(i,a)&&(s=i),null==s&&(s=n),b(s,a,o),void 0;for(var u,c=null!=a.length&&"function"==typeof a.splice,h=c===!0?a.length:1,f=0;h>f;f++)if(u=c?a[f]:a,null!=u){if("object"==typeof u){if(s=t(u.accessor,n,r,i),null==s||"object"!=typeof s){console.error("Binding failed to an object over accessor",u);continue}u=u.ref}else s=w(n,u)?n:w(i,u)?i:n;null!=u&&"$c"!==u&&b(s,u,o)}}},H=function(e,n,r,i){if("function"==typeof r&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===e)return F(n,i),void 0;var o,s=Q(e);if(null!=s){if("string"==typeof s)return w(n,s)&&_(n,s,i),w(r,s)&&_(r,s,i),void 0;for(var o,l=null!=s.length&&"function"==typeof s.splice,a=l===!0?s.length:1,u=0;a>u;u++)if(o=l?s[u]:s,null!=o)if("object"!=typeof o)w(n,o)&&_(n,o,i),w(r,o)&&_(r,o,i);else{var c=t(o.accessor,n,null,r);c&&_(c,o.ref,i)}}},U=function(e,n,t,r,i){var o=0;return function(){if(++o>1)return o=0,console.warn("<mask:bind:expression> Concurent binder detected",e),void 0;var s=D(e,n,t,r);if(arguments.length>1){var l=I.call(arguments);l[0]=s,i.apply(this,l)}else i(s);o--}},G=function(e){var n=0;return function(){return++n>1?(n=0,console.warn("<mask:listener:expression> concurent binder"),void 0):(e(),n--,void 0)}}})();var X,Z;(function(){X=function(e,n,t){for(var r,i,o,s,l=e.split(";"),a=[],u=0,c=l.length;c>u;u++)r=l[u].split(":"),1===r.length||2===r.length?(o=2==r.length?r[0]:t,i=r[2==r.length?1:0],s=Z(i.trim(),o,n),null!=s&&a.push(s)):console.error('Too much ":" in a signal def.',l[u]);return a},Z=function(e,n,t){if(t!==!0)return{signal:e,type:n};var r=e.indexOf(".");return-1===r?(console.error("No pipe name in a signal",e),null):{signal:e.substring(r+1),pipe:e.substring(0,r),type:n}}})();var q=function(){function e(e,n,t,r){null==r&&(r=":bind"===t.compoName?"single":"dual");var i,s=t.attr;if(this.node=t,this.controller=t,this.model=e,this.element=n,this.value=s.value,this.property=s.property,this.setter=s.setter,this.getter=s.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(n.tagName){case"INPUT":if(i=n.getAttribute("type"),"checkbox"===i){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=o.SELECT;break;default:this.property="element.innerHTML"}if(s.log&&(this.log=!0,"log"!==s.log&&(this.logExpression=s.log)),s["x-signal"]){var l=X(s["x-signal"],null,"dom")[0],a=l&&l.type;switch(a){case"dom":case"object":this["signal_"+a+"Changed"]=l.signal;break;default:console.error("Signal typs is not supported",l)}}if(s["x-pipe-signal"]){var l=X(s["x-pipe-signal"],!0,"dom")[0],a=l&&l.type;switch(a){case"dom":case"object":this["pipe_"+a+"Changed"]=l;break;default:console.error("Pipe type is not supported")}}if(s["dom-slot"]){this.slots={};var u=t.parent,c=u.parent;u.parent=this,this.parent=c,this.slots[s["dom-slot"]]=function(e,n){this.domChanged(e,n)}}var h=s["object-pipe-slot"]||s["x-pipe-slot"];if(h){var f=h,d=f.indexOf("."),p=f.substring(0,d),l=f.substring(d+1);this.pipes={},this.pipes[p]={},this.pipes[p][l]=function(){this.objectChanged()},E.pipe.addController(this)}if(s.expression){if(this.expression=s.expression,null==this.value&&"single"!==r){var v=Q(this.expression);"string"==typeof v?this.value=v:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function t(e){var n=e.expression,t=e.model,r=e.objectChanged=e.objectChanged.bind(e);if(e.binder=U(n,t,e.cntx,e.node,r),R(n,t,e.cntx,e.node,e.binder),"dual"===e.bindingType){var i=e.node.attr;if(!i["change-slot"]&&!i["change-pipe-event"]){var o=e.element,s=i["change-event"]||i.changeEvent||"change",l=e.domChanged.bind(e);S(o,s,l)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function r(e,n,t){var i=e.slots;(null==i||"function"!=typeof i[n]||i[n].apply(e,t)!==!1)&&null!=e.parent&&r(e.parent,n,t)}var i={};n.registerBinding=function(e,n){i[e]=n},n.BindingProvider=e,e.create=function(n,t,r,o){var s,l=r.attr.bindingProvider,a=null==l?null:i[l];return"function"==typeof a?new a(n,t,r,o):(s=new e(n,t,r,o),null!=a&&k(s,a),s)},e.bind=function(e){return t(e)},e.prototype={constructor:e,dispose:function(){H(this.expression,this.model,this.controller,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&r(this.node,this.signal_objectChanged,[e]),this.pipe_objectChanged){var n=this.pipe_objectChanged;E.pipe(n.pipe).emit(n.signal)}this.locked=!1}},domChanged:function(e,n){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var t=n||this.domWay.get(this),i=!0;if(this.node.validations)for(var o,s=0,l=this.node.validations.length;l>s;s++)if(o=this.node.validations[s],o.validate(t,this.element,this.objectChanged.bind(this))===!1){i=!1;break}if(i&&(this.dismiss=1,this.objectWay.set(this.model,this.value,t),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",t),this.signal_domChanged&&r(this.node,this.signal_domChanged,[t]),this.pipe_domChanged)){var a=this.pipe_domChanged;E.pipe(a.pipe).emit(a.signal)}this.locked=!1},objectWay:{get:function(e,n){return D(n,e.model,e.cntx,e.controller)},set:function(e,n,t){m(e,n,t)}},domWay:{get:function(e){if(e.getter){var n=e.node.parent;return null==n||"function"!=typeof n[e.getter]?(console.error("Mask.bindings: Getter should be a function",e.getter,e),null):n[e.getter]()}return g(e,e.property)},set:function(e,n){if(e.setter){var t=e.node.parent;if(null==t||"function"!=typeof t[e.setter])return console.error("Mask.bindings: Setter should be a function",e.setter,e),void 0;t[e.setter](n)}else m(e,e.property,n)}}};var o={SELECT:{get:function(e){var n=e.element;return-1===n.selectedIndex?"":n.options[n.selectedIndex].getAttribute("name")},set:function(e,n){for(var t,r=e.element,i=0,o=r.options.length;o>i;i++)if(t=r.options[i],t.getAttribute("name")==n)return r.selectedIndex=i,void 0}}};return k(e,{addObserver:b,removeObserver:_}),e}();O(":visible",f),f.prototype={constructor:f,refresh:function(e,n){n.style.display=D(this.attr.check,e)?"":"none"},renderStart:function(e,n,t){this.refresh(e,t),this.attr.bind&&b(e,this.attr.bind,this.refresh.bind(this,e,t))}},function(){function e(){}O(":bind",e),e.prototype={constructor:e,renderEnd:function(e,n,t,r){this.provider=q.create(n,r,this,"single"),q.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),O(":dualbind",d),d.prototype={constructor:d,renderEnd:function(e,t,r,i){if(this.provider=q.create(t,i,this),this.components)for(var o,s=0,l=this.components.length;l>s;s++)o=this.components[s],":validate"===o.compoName&&(this.validations||(this.validations=[])).push(o);if(!this.attr["no-validation"]&&!this.validations){var a=t.Validate,u=this.provider.value;if(null==a&&-1!==u.indexOf(".")){for(var c=u.split("."),s=0,h=c.length,f=t[c[0]];null==a&&h>++s&&f;)a=f.Validate,f=f[c[s]];u=c.slice(s).join(".")}var d=a&&a[u];"function"==typeof d&&(d=n.getHandler(":validate").createCustom(i,d),(this.validations||(this.validations=[])).push(d))}q.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function e(){}function t(e,n){this.fn=e,this.message=n}function r(e,n,t){console.warn("Validate Notification:",e,n);var r=N(e).next("."+o);return 0===r.length&&(r=N("<div>").addClass(o).html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),t&&t()}).end().children("span").text(n).end().show()}function i(e){return N(e).next("."+o).hide()}var o="-validate-invalid";n.registerValidator=function(e,n){s[e]=n},O(":validate",e),e.prototype={constructor:e,attr:{},renderStart:function(n,r,i){if(this.element=i,this.attr.value){var o=e.resolveFromModel(n,this.attr.value);o&&(this.validators=[new t(o)])}},validate:function(e,n,t){null==n&&(n=this.element),this.attr&&(null==e&&this.attr.getter&&(e=g({node:this,element:n},this.attr.getter)),null==e&&this.attr.value&&(e=g(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,i=0,o=this.validators.length;o>i;i++)if(r=this.validators[i].validate(e),r&&!this.attr.silent)return this.notifyInvalid(n,r,t),!1;return this.makeValid(n),!0},notifyInvalid:function(e,n,t){return r(e,n,t)},makeValid:function(e){return i(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in s!=!1){var n=s[e];this.validators.push(new t(n(this.attr[e],this),this.attr.message))}else console.error("Unknown Validator:",e,this)}}},e.resolveFromModel=function(e,n){return g(e.Validate,n)},e.createCustom=function(n,r){var i=new e;return i.element=n,i.validators=[new t(r)],i},t.prototype.validate=function(e){var n=this.fn(e);return n===!1?this.message||"Invalid - "+e:n},O(":validate:message",Compo({template:"div."+o+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,n){var t=this;this.model.message=e,this.compos.button.off().on(function(){t.hide(),n&&n()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(e){return function(n){return RegExp(e).test(n)}},unmatch:function(e){return function(n){return!RegExp(e).test(n)}},minLength:function(e){return function(n){return n.length>=parseInt(e,10)}},maxLength:function(e){return function(n){return n.length<=parseInt(e,10)}},check:function(e,n){return function(t){return D("x"+e,n.model,{x:t},n)}}}}(),O(":validate:group",p),p.prototype={constructor:p,validate:function(){for(var e,n=v(this),t=0,r=n.length;r>t;t++)if(e=n[t],!e.validate())return!1;return!0}},function(){function e(e,n,t){return e?null==n||""===n?e+" "+t:e.replace(n,t):t}function n(n,t,r,i,o){return function(t){switch(n){case"node":r.textContent=t;break;case"attr":var s,l,a=typeof r[o];if("boolean"===a)return i=r[o]=!!t,void 0;if("string"===a)return i=r[o]=e(r[o],i,t),void 0;s=r.getAttribute(o),l=e(s,i,t),r.setAttribute(o,l),i=t}}}function t(e,t,r,i,o,s,l,a){var u=n(a,t,o,e,l),c=U(t,r,i,s,u);R(t,r,i,s,c),h(s,function(){H(t,r,s,c)})}$("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,n,t,r,i){var o=D(e,n,t,i);return this.element=document.createTextNode(o),this.current=o},node:function(e,n,r,i,o){return t(this.current,e,n,r,this.element,o,null,"node"),this.element},attrRenderStart:function(e,n,t,r,i){return this.current=D(e,n,t,i)},attr:function(e,n,r,i,o,s){return t(this.current,e,n,r,i,o,s,"attr"),this.current}})}(),T("xx-visible",function(e,n,t,r,i,o){var s=U(n,t,r,o,function(e){i.style.display=e?"":"none"});R(n,t,r,o,s),h(o,function(){H(n,t,o,s)}),D(n,t,r,o)||(i.style.display="none")}),T("x-toggle","client",function(e,n,t,r,i,o){var s=n.substring(0,n.indexOf(":")),l=n.substring(s.length+1),a=Q(l);"string"!=typeof a&&(a=a[0]),S(i,s,function(){var e=D(l,t,r,o);m(t,a,e)})}),T("x-class-toggle","client",function(e,n,t,r,i){var o=n.substring(0,n.indexOf(":")),s=n.substring(o.length+1).trim();S(i,o,function(){N(i).toggleClass(s)})}),function(e){function n(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",n);var t=function(){var e={refresh:function(e){this.model=e,this.elements&&(i(this.elements),this.elements=[]),null!=E&&E.dispose(this),s(a(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){H(this.expr,this.originalModel,this,this.binder)}};return function(n,t,r,i){var o=n.attr.use;k(n,{expr:o,placeholder:document.createComment(""),binder:U(o,t,r,n,e.refresh.bind(n)),originalModel:t,model:D(o,t,r,n),dispose:e.dispose}),R(o,t,r,n,n.binder),i.appendChild(n.placeholder)}}(),r=function(){return function(e,n,t){function r(e){console.log("Logger > Key: %s, Value: %s",i,e)}var i=e.attr.log,o=U(i,n,t,e,r),s=D(i,n,t,e);R(i,n,t,e,o),h(e,function(){H(i,n,e,o)}),r(s)}}(),o=function(){function e(e,n){return function(){return e.apply(n,arguments)}}var n={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(s(a(this,this.template,this.model,this.cntx),this.placeholder),this.$=N(this.elements)):(null==this.$&&(this.$=N(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){H(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(t,r,i,o){var s=t.attr["if"];k(t,{expr:s,template:t.nodes,placeholder:document.createComment(""),binder:U(s,r,i,t,e(n.refresh,t)),state:!!D(s,r,i,t)}),t.state||(t.nodes=null),R(s,r,i,t,t.binder),o.appendChild(t.placeholder)}}(),f=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return s(a(this,this.template,this.model,this.cntx)),this.$=N(this.elements),void 0;null==this.$&&(this.$=N(this.elements)),this.$[e?"hide":"show"]()}}};return function(n,t,r,i){var o=n.parent.components,s=o&&o[o.length-1];return n.template=n.nodes,n.placeholder=document.createComment(""),null==s||"%%"!==s.compoName||null==s.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(s.onchange=e.refresh.bind(n),s.state&&(n.nodes=null),i.appendChild(n.placeholder),void 0)}}(),d=function(){function n(e,n){var t=[];if(null==n||"object"!=typeof n||null==n.length)return t;for(var r,i=0,o=n.length;o>i;i++){switch(r=n[i],typeof r){case"string":case"number":case"boolean":r=n[i]=Object(r)}t[i]=new h(e.template,r,e)}return t}function t(e,n){for(var t=e.components,r=0,i=t.length,o=0,l=null,a=null,u=null,c=document.createDocumentFragment(),h=[];i>r;r++)if(u=t[r],null!=u.elements&&0!==u.elements.length)for(o=0,l=u.elements.length;l>o;o++)a=u.elements[o],a.parentNode.removeChild(a);e:for(o=0,l=n.length;l>o;o++){for(r=0;i>r;r++)if(n[o]===t[r].model){h[o]=t[r];continue e}console.warn("No Model Found for",n[o])}for(r=0,i=h.length;i>r;r++)if(u=h[r],null!=u.elements&&0!==u.elements.length)for(o=0,l=u.elements.length;l>o;o++)a=u.elements[o],c.appendChild(a);e.components=h,s(c,e.placeholder)}function r(e,t,r,i,s){if(null!=t&&null!=r){var h=t,f=t+r;for(f>e.components.length&&(f=e.components.length);f>h;h++)u(e.components[h],e)&&(h--,f--)}if(null!=i&&s&&s.length){var d=new o,p=n(e,s),v=a(d,p),g=d.components;l(e,i,v),c(d),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[i,0].concat(g))}}function i(e,n){for(var t,r=e.components,i=r.length;--i>-1;)t=r[i],-1!==n.indexOf(t.model)&&u(t,e)}var o=e.Dom.Component,h=function(){function e(e,n,t){this.nodes=e,this.model=n,this.parent=t}var n=o.prototype;e.prototype={compoName:"%%.each.item",constructor:f,renderEnd:function(e){this.elements=e}};for(var t in n)e.prototype[t]=n[t];return e}(),f={append:function(n){var t=new h(this.template,n,this);e.render(t,n,null,this.container,this)}},d={refresh:function(e,o,l,h){var f,d,p=0;if(null==o){if(null!=this.components)for(p=0,d=this.components.length;d>p;p++)f=this.components[p],u(f,this)&&(p--,d--);return this.components=[],this.nodes=n(this,e),s(a(this,this.nodes),this.placeholder),A(this.components,c),void 0}for(d=e.length;d>p;p++)switch(f=e[p],typeof f){case"string":case"number":case"boolean":e[p]=Object(f)}switch(o){case"push":r(this,null,null,e.length,e.slice(e.length-1));break;case"pop":r(this,e.length,1);break;case"unshift":r(this,null,null,0,e.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var v=l[0],g=1===l.length?this.components.length:l[1],m=l.length>2?e.slice(l[0],l.length-2+l[0]):null;r(this,v,g,v,m);break;case"sort":case"reverse":t(this,e);break;case"remove":null!=h&&h.length&&i(this,h)}},dispose:function(){H(this.expr,this.model,this,this.refresh)}};return function(e,t,r,i){null==e.nodes&&"undefined"!=typeof Compo&&Compo.ensureTemplate(e);var o=e.attr.each||e.attr.foreach,s=D(o,t,r,e);k(e,{expr:o,binder:U(o,t,r,e,d.refresh.bind(e)),template:e.nodes,container:i,placeholder:document.createComment(""),dispose:d.dispose}),i.appendChild(e.placeholder),R(e.expr,t,r,e,e.binder);for(var l in f)e[l]=f[l];e.nodes=n(e,s)}}(),p=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=D(this.expr,this.model,this.cntx,this),n=0,t=this.elements.length;t>n;n++)this.elements[n].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){H(this.expr,this.model,this,this.binder)}};return function(n,t,r){var i=n.attr.visible;k(n,{expr:i,binder:U(i,t,r,n,e.refresh.bind(n)),dispose:e.dispose}),R(i,t,r,n,n.binder),e.refresh.call(n)}}();n.prototype={constructor:n,elements:null,renderStart:function(e,n,i){var s=this.attr;return null==s["debugger"]?null!=s.use?(t(this,e,n,i),void 0):null!=s.log?(r(this,e,n,i),void 0):(this.model=e,null!=s["if"]?(o(this,e,n,i),void 0):null!=s["else"]?(f(this,e,n,i),void 0):((null!=s.each||null!=s.foreach)&&d(this,e,n,i),void 0)):void 0},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&p(this,this.model,this.cntx)}}}(n),function(){var e,r,i,o=n.getStatement();(function(){e=function(e,n,t,r,i){return o[e].getNodes(n,t,r,i)},r=function(e,n,t,r,i,o){var s=[];if(j(e,n,t,r,i,s),null==o)return s;for(var l=o.length,a=s.length,u=-1;a>++u;)o[l+u]=s[u];return s},i=function(e,n){if(null!=e)for(var t,r="function"==typeof e.splice,i=r?e.length:1,o=-1;i>++o;)t=r?e[o]:e,t.style.display=n?"":"none"}})(),function(){function o(){}function l(e,n,r,i,o,s,l,a){for(e.model=o,e.ctx=s,e.controller=a,e.refresh=t(e.refresh,e),e.binder=G(e.refresh),e.index=r,e.Switch=[{node:n,elements:null}],R(n.expression,o,s,a,e.binder);n=n.nextSibling,null!=n&&"else"===n.tagName;)e.Switch.push({node:n,elements:null}),n.expression&&R(n.expression,o,s,a,e.binder);e.Switch[r].elements=i}n.registerHandler("+if",{render:function(n,t,i,o,s){for(var l=this,a=e("if",l,n,t,o),u=0,c=l;null!=c&&c.nodes!==a;)u++,c=l.nextSibling;return this.attr["switch-index"]=u,r(a,n,t,i,o,s)},renderEnd:function(e,n,t,r,i){var s=new o,a=this.attr["switch-index"];return s.placeholder=document.createComment(""),r.appendChild(s.placeholder),l(s,this,a,e,n,t,r,i),s}}),o.prototype={ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(){for(var e,t=this,r=t.Switch,o=r.length,l=-1,a=t.index,u=t.model,c=t.ctx,h=t.controller;o>++l&&(e=r[l].node.expression,null!=e)&&!D(e,u,c,h););if(a!==l){if(null!=a&&i(r[a].elements,!1),l===o)return t.index=null,void 0;this.index=l;var f=r[l];if(null!=f.elements)return i(f.elements,!0),void 0;var d=n.render(f.node.nodes,u,c,null,h),p=d.nodeType===Node.DOCUMENT_FRAGMENT_NODE?I.call(d.childNodes):d;s(d,t.placeholder),f.elements=p}},dispose:function(){for(var e,n,t=this.Switch,r=t.length,i=-1;r>++i;)e=t[i],n=e.node.expression,n&&H(n,this.model,this.controller,this.binder),e.node=null,e.elements=null;this.controller=null,this.model=null,this.ctx=null}}}(),function(){function e(e,n,r,i,o,s,l){e.parent=l,e.model=i,e.refresh=t(e.refresh,e),e.binder=U(e.expr,i,o,l,e.refresh),R(e.expr,i,o,l,e.binder)}function r(e,n){this.prop1=n[p],this.prop2=n[v],this.type=n[g],this.expr=n[m],null==e.components&&(e.components=[]),this.node=e,this.components=e.components}function i(e){for(var n,t=e.length,r=-1;t>++r;)switch(n=e[r],typeof n){case"string":case"number":case"boolean":e[r]=Object(n)}}function a(e,n){for(var t=e.node.components,r=0,i=t.length,o=0,l=null,a=null,u=null,c=document.createDocumentFragment(),h=[];i>r;r++)if(u=t[r],null!=u.elements&&0!==u.elements.length)for(o=0,l=u.elements.length;l>o;o++)a=u.elements[o],a.parentNode.removeChild(a);e:for(o=0,l=n.length;l>o;o++){for(r=0;i>r;r++)if(n[o]===t[r].scope[e.prop1]){h[o]=t[r];continue e}console.warn("No Model Found for",n[o])}for(r=0,i=h.length;i>r;r++)if(u=h[r],null!=u.elements&&0!==u.elements.length)for(o=0,l=u.elements.length;l>o;o++)a=u.elements[o],c.appendChild(a);e.components=e.node.components=h,s(c,e.placeholder)}function h(e,t,r,i,o){var s=e.node,a=s.components;null==a&&(a=s.components=[]);var h=e.prop1,f=e.prop2,p=e.type,v=e.ctx;if(e.node,null!=t&&null!=r){var g=t,m=t+r;for(m>a.length&&(m=a.length);m>g;g++)u(a[g],s)&&(g--,m--)}if(null!=i&&o&&o.length){var b=new n.Dom.Component,y=d.getNodes(s.nodes,o,h,f,p),_=j(y,o,v,null,b);l(s,i,_,e.placeholder),c(b),a.splice.apply(a,[i,0].concat(b.components))}}function f(e,n){for(var t,r=e.components,i=r.length;--i>-1;)t=r[i],-1!==n.indexOf(t.model)&&u(t,e.node)}var d=o["for"],p="for-prop-1",v="for-prop-2",g="for-type",m="for-expr";n.registerHandler("+for",{render:function(e,n,t,r,o){var s=d.parseFor(this.expression),l=this.attr;l[p]=s[0],l[v]=s[1],l[g]=s[2],l[m]=s[3];var a=D(s[3],e,n,r);null!=a&&(M(a)&&i(a),d.build(a,s,this.nodes,e,n,t,this,o))},renderEnd:function(n,t,i,o,s){var l=new r(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),e(l,this,n,t,i,o,s),l}}),r.prototype={compoName:"+for",model:null,parent:null,refresh:function(e,n,t,r){var o,l=0,p=this.node,v=this.prop1,g=this.prop2,m=this.type,b=this.model,y=this.ctx,_=this.node;if(null==n){var x=p.components;if(null!=x){for(var o=x.length,l=-1;o>++l;)u(x[l],p)&&(l--,o--);x.length=0}var C=j(d.getNodes(p.nodes,e,v,g,m),b,y,null,_);return s(C,this.placeholder),A(p.components,c),void 0}var k=e;switch(i(e),n){case"push":h(this,null,null,k.length,k.slice(k.length-1));break;case"pop":h(this,k.length,1);break;case"unshift":h(this,null,null,0,k.slice(0,1));break;case"shift":h(this,0,1);break;case"splice":var w=t[0],N=1===t.length?this.components.length:t[1],E=t.length>2?k.slice(t[0],t.length-2+t[0]):null;h(this,w,N,w,E);break;case"sort":case"reverse":a(this,k);break;case"remove":null!=r&&r.length&&f(this,r)}},dispose:function(){H(this.expr,this.model,this.parent,this.binder)}}}()}()})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);