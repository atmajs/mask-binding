(function(e,t){"use strict";function n(e){return e.parentNode.removeChild(e)}function i(e){if(null!=e)for(var t=0,i=e.length;i>t;t++)n(e[t])}function r(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function o(e,t){return t.parentNode.insertBefore(e,t)}function s(e,t,n){if(null==e.components)return r(n,e.placeholder);for(var i,s=e.components,l=null,a=!0,u=s.length,h=t;u>h;h++)if(i=s[h].elements,i&&i.length){l=i[0];break}if(null==l)for(a=!1,h=u>t?t:u;--h>-1;)if(i=s[h].elements,i&&i.length){l=i[i.length-1];break}return null==l&&(l=e.placeholder),a?o(n,l):r(n,l)}function l(e,n,i,r,o){return t.render(n,i,r,o,e)}function a(e,t){if(null==e)return!1;i(e.elements),e.elements=null,null!=E&&E.dispose(e);var n=t&&t.components||e.parent&&e.parent.components;return null==n?(console.error("Parent Components Collection is undefined"),!1):P(n,e)}function u(e){null!=E&&E.signal.emitIn(e,"domInsert")}function h(e,t){if("function"==typeof e.dispose){var n=e.dispose;return e.dispose=function(){t.call(this),n.call(this)},void 0}e.dispose=t}function c(){}function f(){}function d(){}function p(e,t){if(null==t&&(t=[]),null==e.components)return t;for(var n,i=e.components,r=0,o=i.length;o>r;r++)n=i[r],"validate"!==n.compoName?p(n):t.push(n);return t}var v,g,m,b,y,_,x,C,k,w=t.build,j=e.jQuery||e.Zepto||e.$,E="undefined"!=typeof Compo?Compo:t.Compo||e.Compo,$=E.Dom.addEventListener,N=t.registerHandler,O=t.registerAttrHandler,S=t.registerUtil,T=Array.prototype.slice;(function(){function e(e,t){for(var n,i=-1,r=t.length-1;r>++i;)n=t[i],null==e[n]&&(e[n]={}),e=e[n];return e}function t(t,i,r,o){var s=o.length,l=s>1?e(t,o):t,a=o[s-1],u=l[a];return s>1&&n(t,o),"length"===a&&I(l)?(B(l,function(e,t,n,i){for(var o=r.length,s=-1;o>++s;)r[s](e,t,n,i)}),u):(Object.defineProperty(l,a,{get:function(){return u},set:function(e){var t=0,n=r.length;if(e!==u){if(u=e,I(e))for(t=0;n>t;t++)B(e,r[t]);if(null!=r.__dirties)return r.__dirties[i]=1,void 0;for(t=0;n>t;t++)r[t](e)}},configurable:!0}),u)}function n(e,t){for(var n,o=r(e),s="",l=0,a=t.length-1;a>l;l++)n=t[l],s+=n+".",i(s,e,n,o),e=e[n]}function i(e,t,n,i){var r,o=t[n];Object.defineProperty(t,n,{get:function(){return o},set:function(t){t!==o&&(r=o,o=t,i(e,r))},configurable:!0})}function r(e){return function(t,n){var i=e.__observers;if(null!=i)for(var r in i)if(0===r.indexOf(t)){var o=i[r].slice(0),s=o.length,l=0;if(0!==s){var a,u,h=v(e,r);for(l=0;s>l;l++)a=o[l],y(e,r,a),u=r.substring(t.length),y(n,u,a);for(l=0;s>l;l++)o[l](h);for(l=0;s>l;l++)m(e,r,o[l])}}}}function o(e,t,n){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var i=e.__observers;return null!=i[t]?-1===A(i[t],n)&&i[t].push(n):i[t]=[n],i[t]}v=function(e,t){for(var n=t.split("."),i=n.length,r=-1;i>++r;){if(null==e)return null;e=e[n[r]]}return e},g=function(e,t,n){for(var i,r=t.split("."),o=r.length-1,s=-1;o>++s;)i=r[s],null==e[i]&&(e[i]={}),e=e[i];e[r[s]]=n},m=function(e,n,i){for(var r=n.split("."),s=r.length,l=-1,a=e;s>++l&&(a=a[r[l]],null!=a);)if(null!=a.__observers){var u=r.slice(l+1).join(".");if(a.__observers[u]){o(a,u,i);var h=o(e,n,i);if(1===h.length){var c=r.splice(0,l);c.length&&t(e,n,h,c,!0)}return}}var h=o(e,n,i);1===h.length&&t(e,n,h,r,!0);var f=v(e,n);I(f)&&B(f,i)},b=function(e,t,n){for(var i=t.split("."),r=i.length,o=-1,s=e;r>++o&&(s=s[i[o]],null!=s);)if(null!=s.__observers){if(b(s,i.slice(o).join("."),n))return!0;break}var l=e.__observers;return null==l||null==l[t]?!1:-1!==A(l[t],n)},y=function(e,t,n){for(var i=t.split("."),r=i.length,o=-1,s=e;r>++o&&(s=s[i[o]],null!=s);)if(null!=s.__observers){y(s,i.slice(o).join("."),n);break}var l=e.__observers;if(null!=l&&null!=l[t]){var a=v(e,t);if(2===arguments.length)return l[t].length=0,void 0;P(l[t],n),I(a)&&L(a,n)}},_=function(e){if(I(e))return M(e),void 0;var t=e.__observers;null!=t&&(t.__dirties={})},x=function(e){if(I(e))return W(e),void 0;var t=e.__observers,n=null==t?null:t.__dirties;if(null!=n){for(var i in n){var r=e.__observers[i],o=v(e,i);if(null!=r)for(var s=0,l=r.length;l>s;s++)r[s](o)}t.__dirties=null}},C=function(e,t){if(null==t)return e;null==e&&(e={});for(var n in t)e[n]=t[n];return e},k=function(e,t){if(null==e)return!1;for(var n=t.split("."),i=n.length,r=-1;i>++r;)if(null==(e=e[n[r]]))return!1;return!0}})();var I,P,V,A,B,L,M,W;(function(){function e(e,n,i){return function(){return t(e,n,i,T.call(arguments))}}function t(e,t,n,i){var r=e.__observers&&e.__observers.__array,o=t.apply(e,i);if(null==r||0===r.length)return o;if(null!=e.__observers.__dirty)return e.__observers.__dirty=!0,o;for(var s,l=0,a=r.length;a>l;l++)s=r[l],"function"==typeof s&&s(e,n,i,o);return o}I=function(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.splice},P=function(e){if(null==e)return!1;for(var t,n=0,i=e.length,r=1,o=arguments.length,s=0;i>n;n++)for(t=e[n],r=1;o>r;r++)if(arguments[r]===t){e.splice(n,1),n--,i--,s++;break}return s+1===o},B=function(t,n){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{__dirty:null},enumerable:!1});var i=t.__observers.__array;if(null==i&&(i=t.__observers.__array=[]),0===i.length)for(var r,o,s=0,l=["push","unshift","splice","pop","shift","reverse","sort","remove"],a=l.length;a>s;s++)o=l[s],r=t[o],null!=r&&(t[o]=e(t,r,o));i[i.length++]=n},L=function(e,t){var n=e.__observers&&e.__observers.__array;if(null!=n)for(var i=0,r=n.length;r>i;i++)if(n[i]===t){n[i]=null;for(var o=i;r>o;o++)n[o]=n[o+1];r--,n.length--}},M=function(e){null!=e.__observers&&(e.__observers.__dirty=!1)},W=function(e){var t=e.__observers,n=t&&t.__array;if(null!=n&&t.__dirty===!0){for(var i,r=0,o=n.length;o>r;r++)i=n[r],"function"==typeof i&&i(e);t.__dirty=null}},V=function(e,t){for(var n=0,i=e.length;i>n;n++)t(e[n])},A=function(e,t){return e.indexOf(t)}})();var R,H,F,D,U,G,K;(function(){var e=t.Utils.Expression,n=e.eval;G=e.parse,K=e.varRefs,R=function(e,t,i,r){if("."===e)return t;var o=n(e,t,i,r);return null==o?"":o},H=function(e,t,i,r,o){if("."===e)return I(t)&&B(t,o),void 0;var s,l=G(e),a=K(l);if(null!=a){if("string"==typeof a)return k(t,a)&&(s=t),null==s&&k(r,a)&&(s=r),null==s&&(s=t),m(s,a,o),void 0;for(var u,h=null!=a.length&&"function"==typeof a.splice,c=h===!0?a.length:1,f=0;c>f;f++)if(u=h?a[f]:a,null!=u){if("object"==typeof u){if(s=n(u.accessor,t,i,r),null==s||"object"!=typeof s){console.error("Binding failed to an object over accessor",u);continue}u=u.ref}else s=k(t,u)?t:k(r,u)?r:t;null!=u&&"$c"!==u&&m(s,u,o)}}},F=function(e,t,i,r){if("function"==typeof i&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===e)return L(t,r),void 0;var o,s=K(e);if(null!=s){if("string"==typeof s)return k(t,s)&&y(t,s,r),k(i,s)&&y(i,s,r),void 0;for(var o,l=null!=s.length&&"function"==typeof s.splice,a=l===!0?s.length:1,u=0;a>u;u++)if(o=l?s[u]:s,null!=o)if("object"!=typeof o)k(t,o)&&y(t,o,r),k(i,o)&&y(i,o,r);else{var h=n(o.accessor,t,null,i);h&&y(h,o.ref,r)}}},D=function(e,t,n,i,r){var o=0;return function(){if(++o>1)return o=0,console.warn("<mask:bind:expression> Concurent binder detected",e),void 0;var s=R(e,t,n,i);if(arguments.length>1){var l=T.call(arguments);l[0]=s,r.apply(this,l)}else r(s);o--}},U=function(e){var t=0;return function(){return++t>-1?(t=0,console.warn("<mask:listener:expression> concurent binder"),void 0):(e(),t--,void 0)}}})();var Q,X;(function(){Q=function(e,t,n){for(var i,r,o,s,l=e.split(";"),a=[],u=0,h=l.length;h>u;u++)i=l[u].split(":"),1===i.length||2===i.length?(o=2==i.length?i[0]:n,r=i[2==i.length?1:0],s=X(r.trim(),o,t),null!=s&&a.push(s)):console.error('Too much ":" in a signal def.',l[u]);return a},X=function(e,t,n){if(n!==!0)return{signal:e,type:t};var i=e.indexOf(".");return-1===i?(console.error("No pipe name in a signal",e),null):{signal:e.substring(i+1),pipe:e.substring(0,i),type:t}}})();var Z=function(){function e(e,t,n,i){null==i&&(i=":bind"===n.compoName?"single":"dual");var r,s=n.attr;if(this.node=n,this.controller=n,this.model=e,this.element=t,this.value=s.value,this.property=s.property,this.setter=s.setter,this.getter=s.getter,this.dismiss=0,this.bindingType=i,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(t.tagName){case"INPUT":if(r=t.getAttribute("type"),"checkbox"===r){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=o.SELECT;break;default:this.property="element.innerHTML"}if(s.log&&(this.log=!0,"log"!==s.log&&(this.logExpression=s.log)),s["x-signal"]){var l=Q(s["x-signal"],null,"dom")[0],a=l&&l.type;switch(a){case"dom":case"object":this["signal_"+a+"Changed"]=l.signal;break;default:console.error("Signal typs is not supported",l)}}if(s["x-pipe-signal"]){var l=Q(s["x-pipe-signal"],!0,"dom")[0],a=l&&l.type;switch(a){case"dom":case"object":this["pipe_"+a+"Changed"]=l;break;default:console.error("Pipe type is not supported")}}if(s["dom-slot"]){this.slots={};var u=n.parent,h=u.parent;u.parent=this,this.parent=h,this.slots[s["dom-slot"]]=function(e,t){this.domChanged(e,t)}}var c=s["object-pipe-slot"]||s["x-pipe-slot"];if(c){var f=c,d=f.indexOf("."),p=f.substring(0,d),l=f.substring(d+1);this.pipes={},this.pipes[p]={},this.pipes[p][l]=function(){this.objectChanged()},E.pipe.addController(this)}if(s.expression){if(this.expression=s.expression,null==this.value&&"single"!==i){var v=K(this.expression);"string"==typeof v?this.value=v:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function n(e){var t=e.expression,n=e.model,i=e.objectChanged=e.objectChanged.bind(e);if(e.binder=D(t,n,e.cntx,e.node,i),H(t,n,e.cntx,e.node,e.binder),"dual"===e.bindingType){var r=e.node.attr;if(!r["change-slot"]&&!r["change-pipe-event"]){var o=e.element,s=r["change-event"]||r.changeEvent||"change",l=e.domChanged.bind(e);$(o,s,l)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function i(e,t,n){var r=e.slots;(null==r||"function"!=typeof r[t]||r[t].apply(e,n)!==!1)&&null!=e.parent&&i(e.parent,t,n)}var r={};t.registerBinding=function(e,t){r[e]=t},t.BindingProvider=e,e.create=function(t,n,i,o){var s,l=i.attr.bindingProvider,a=null==l?null:r[l];return"function"==typeof a?new a(t,n,i,o):(s=new e(t,n,i,o),null!=a&&C(s,a),s)},e.bind=function(e){return n(e)},e.prototype={constructor:e,dispose:function(){F(this.expression,this.model,this.controller,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&i(this.node,this.signal_objectChanged,[e]),this.pipe_objectChanged){var t=this.pipe_objectChanged;E.pipe(t.pipe).emit(t.signal)}this.locked=!1}},domChanged:function(e,t){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var n=t||this.domWay.get(this),r=!0;if(this.node.validations)for(var o,s=0,l=this.node.validations.length;l>s;s++)if(o=this.node.validations[s],o.validate(n,this.element,this.objectChanged.bind(this))===!1){r=!1;break}if(r&&(this.dismiss=1,this.objectWay.set(this.model,this.value,n),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",n),this.signal_domChanged&&i(this.node,this.signal_domChanged,[n]),this.pipe_domChanged)){var a=this.pipe_domChanged;E.pipe(a.pipe).emit(a.signal)}this.locked=!1},objectWay:{get:function(e,t){return R(t,e.model,e.cntx,e.controller)},set:function(e,t,n){g(e,t,n)}},domWay:{get:function(e){if(e.getter){var t=e.node.parent;return null==t||"function"!=typeof t[e.getter]?(console.error("Mask.bindings: Getter should be a function",e.getter,e),null):t[e.getter]()}return v(e,e.property)},set:function(e,t){if(e.setter){var n=e.node.parent;if(null==n||"function"!=typeof n[e.setter])return console.error("Mask.bindings: Setter should be a function",e.setter,e),void 0;n[e.setter](t)}else g(e,e.property,t)}}};var o={SELECT:{get:function(e){var t=e.element;return-1===t.selectedIndex?"":t.options[t.selectedIndex].getAttribute("name")},set:function(e,t){for(var n,i=e.element,r=0,o=i.options.length;o>r;r++)if(n=i.options[r],n.getAttribute("name")==t)return i.selectedIndex=r,void 0}}};return C(e,{addObserver:m,removeObserver:y}),e}();N(":visible",c),c.prototype={constructor:c,refresh:function(e,t){t.style.display=R(this.attr.check,e)?"":"none"},renderStart:function(e,t,n){this.refresh(e,n),this.attr.bind&&m(e,this.attr.bind,this.refresh.bind(this,e,n))}},function(){function e(){}N(":bind",e),e.prototype={constructor:e,renderEnd:function(e,t,n,i){this.provider=Z.create(t,i,this,"single"),Z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),N(":dualbind",f),f.prototype={constructor:f,renderEnd:function(e,n,i,r){if(this.provider=Z.create(n,r,this),this.components)for(var o,s=0,l=this.components.length;l>s;s++)o=this.components[s],":validate"===o.compoName&&(this.validations||(this.validations=[])).push(o);if(!this.attr["no-validation"]&&!this.validations){var a=n.Validate,u=this.provider.value;if(null==a&&-1!==u.indexOf(".")){for(var h=u.split("."),s=0,c=h.length,f=n[h[0]];null==a&&c>++s&&f;)a=f.Validate,f=f[h[s]];u=h.slice(s).join(".")}var d=a&&a[u];"function"==typeof d&&(d=t.getHandler(":validate").createCustom(r,d),(this.validations||(this.validations=[])).push(d))}Z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function e(){}function n(e,t){this.fn=e,this.message=t}function i(e,t,n){console.warn("Validate Notification:",e,t);var i=j(e).next("."+o);return 0===i.length&&(i=j("<div>").addClass(o).html("<span></span><button>cancel</button>").insertAfter(e)),i.children("button").off().on("click",function(){i.hide(),n&&n()}).end().children("span").text(t).end().show()}function r(e){return j(e).next("."+o).hide()}var o="-validate-invalid";t.registerValidator=function(e,t){s[e]=t},N(":validate",e),e.prototype={constructor:e,attr:{},renderStart:function(t,i,r){if(this.element=r,this.attr.value){var o=e.resolveFromModel(t,this.attr.value);o&&(this.validators=[new n(o)])}},validate:function(e,t,n){null==t&&(t=this.element),this.attr&&(null==e&&this.attr.getter&&(e=v({node:this,element:t},this.attr.getter)),null==e&&this.attr.value&&(e=v(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var i,r=0,o=this.validators.length;o>r;r++)if(i=this.validators[r].validate(e),i&&!this.attr.silent)return this.notifyInvalid(t,i,n),!1;return this.makeValid(t),!0},notifyInvalid:function(e,t,n){return i(e,t,n)},makeValid:function(e){return r(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in s!=!1){var t=s[e];this.validators.push(new n(t(this.attr[e],this),this.attr.message))}else console.error("Unknown Validator:",e,this)}}},e.resolveFromModel=function(e,t){return v(e.Validate,t)},e.createCustom=function(t,i){var r=new e;return r.element=t,r.validators=[new n(i)],r},n.prototype.validate=function(e){var t=this.fn(e);return t===!1?this.message||"Invalid - "+e:t},N(":validate:message",Compo({template:"div."+o+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,t){var n=this;this.model.message=e,this.compos.button.off().on(function(){n.hide(),t&&t()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(e){return function(t){return RegExp(e).test(t)}},unmatch:function(e){return function(t){return!RegExp(e).test(t)}},minLength:function(e){return function(t){return t.length>=parseInt(e,10)}},maxLength:function(e){return function(t){return t.length<=parseInt(e,10)}},check:function(e,t){return function(n){return R("x"+e,t.model,{x:n},t)}}}}(),N(":validate:group",d),d.prototype={constructor:d,validate:function(){for(var e,t=p(this),n=0,i=t.length;i>n;n++)if(e=t[n],!e.validate())return!1;return!0}},function(){function e(e,t,n){return e?null==t||""===t?e+" "+n:e.replace(t,n):n}function t(t,n,i,r,o){return function(n){switch(t){case"node":i.textContent=n;break;case"attr":var s,l,a=typeof i[o];if("boolean"===a)return r=i[o]=!!n,void 0;if("string"===a)return r=i[o]=e(i[o],r,n),void 0;s=i.getAttribute(o),l=e(s,r,n),i.setAttribute(o,l),r=n}}}function n(e,n,i,r,o,s,l,a){var u=t(a,n,o,e,l),c=D(n,i,r,s,u);H(n,i,r,s,c),h(s,function(){F(n,i,s,c)})}S("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,t,n,i,r){var o=R(e,t,n,r);return this.element=document.createTextNode(o),this.current=o},node:function(e,t,i,r,o){return n(this.current,e,t,i,this.element,o,null,"node"),this.element},attrRenderStart:function(e,t,n,i,r){return this.current=R(e,t,n,r)},attr:function(e,t,i,r,o,s){return n(this.current,e,t,i,r,o,s,"attr"),this.current}})}(),O("xx-visible",function(e,t,n,i,r,o){var s=D(t,n,i,o,function(e){r.style.display=e?"":"none"});H(t,n,i,o,s),h(o,function(){F(t,n,o,s)}),R(t,n,i,o)||(r.style.display="none")}),O("x-toggle","client",function(e,t,n,i,r,o){var s=t.substring(0,t.indexOf(":")),l=t.substring(s.length+1),a=K(l);"string"!=typeof a&&(a=a[0]),$(r,s,function(){var e=R(l,n,i,o);g(n,a,e)})}),O("x-class-toggle","client",function(e,t,n,i,r){var o=t.substring(0,t.indexOf(":")),s=t.substring(o.length+1).trim();$(r,o,function(){j(r).toggleClass(s)})}),function(e){function t(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",t);var n=function(){var e={refresh:function(e){this.model=e,this.elements&&(i(this.elements),this.elements=[]),null!=E&&E.dispose(this),o(l(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){F(this.expr,this.originalModel,this,this.binder)}};return function(t,n,i,r){var o=t.attr.use;C(t,{expr:o,placeholder:document.createComment(""),binder:D(o,n,i,t,e.refresh.bind(t)),originalModel:n,model:R(o,n,i,t),dispose:e.dispose}),H(o,n,i,t,t.binder),r.appendChild(t.placeholder)}}(),r=function(){return function(e,t,n){function i(e){console.log("Logger > Key: %s, Value: %s",r,e)}var r=e.attr.log,o=D(r,t,n,e,i),s=R(r,t,n,e);H(r,t,n,e,o),h(e,function(){F(r,t,e,o)}),i(s)}}(),c=function(){function e(e,t){return function(){return e.apply(t,arguments)}}var t={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(o(l(this,this.template,this.model,this.cntx),this.placeholder),this.$=j(this.elements)):(null==this.$&&(this.$=j(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){F(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(n,i,r,o){var s=n.attr["if"];C(n,{expr:s,template:n.nodes,placeholder:document.createComment(""),binder:D(s,i,r,n,e(t.refresh,n)),state:!!R(s,i,r,n)}),n.state||(n.nodes=null),H(s,i,r,n,n.binder),o.appendChild(n.placeholder)}}(),f=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return o(l(this,this.template,this.model,this.cntx)),this.$=j(this.elements),void 0;null==this.$&&(this.$=j(this.elements)),this.$[e?"hide":"show"]()}}};return function(t,n,i,r){var o=t.parent.components,s=o&&o[o.length-1];return t.template=t.nodes,t.placeholder=document.createComment(""),null==s||"%%"!==s.compoName||null==s.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(s.onchange=e.refresh.bind(t),s.state&&(t.nodes=null),r.appendChild(t.placeholder),void 0)}}(),d=function(){function t(e,t){var n=[];if(null==t||"object"!=typeof t||null==t.length)return n;for(var i,r=0,o=t.length;o>r;r++){switch(i=t[r],typeof i){case"string":case"number":case"boolean":i=t[r]=Object(i)}n[r]=new c(e.template,i,e)}return n}function n(e,t){for(var n=e.components,i=0,r=n.length,s=0,l=null,a=null,u=null,h=document.createDocumentFragment(),c=[];r>i;i++)if(u=n[i],null!=u.elements&&0!==u.elements.length)for(s=0,l=u.elements.length;l>s;s++)a=u.elements[s],a.parentNode.removeChild(a);e:for(s=0,l=t.length;l>s;s++){for(i=0;r>i;i++)if(t[s]===n[i].model){c[s]=n[i];continue e}console.warn("No Model Found for",t[s])}for(i=0,r=c.length;r>i;i++)if(u=c[i],null!=u.elements&&0!==u.elements.length)for(s=0,l=u.elements.length;l>s;s++)a=u.elements[s],h.appendChild(a);e.components=c,o(h,e.placeholder)}function i(e,n,i,r,o){if(null!=n&&null!=i){var c=n,f=n+i;for(f>e.components.length&&(f=e.components.length);f>c;c++)a(e.components[c],e)&&(c--,f--)}if(null!=r&&o&&o.length){var d=new h,p=t(e,o),v=l(d,p),g=d.components;s(e,r,v),u(d),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[r,0].concat(g))}}function r(e,t){for(var n,i=e.components,r=i.length;--r>-1;)n=i[r],-1!==t.indexOf(n.model)&&a(n,e)}var h=e.Dom.Component,c=function(){function e(e,t,n){this.nodes=e,this.model=t,this.parent=n}var t=h.prototype;e.prototype={compoName:"%%.each.item",constructor:f,renderEnd:function(e){this.elements=e}};for(var n in t)e.prototype[n]=t[n];return e}(),f={append:function(t){var n=new c(this.template,t,this);e.render(n,t,null,this.container,this)}},d={refresh:function(e,s,h,c){var f,d,p=0;if(null==s){if(null!=this.components)for(p=0,d=this.components.length;d>p;p++)f=this.components[p],a(f,this)&&(p--,d--);return this.components=[],this.nodes=t(this,e),o(l(this,this.nodes),this.placeholder),V(this.components,u),void 0}for(d=e.length;d>p;p++)switch(f=e[p],typeof f){case"string":case"number":case"boolean":e[p]=Object(f)}switch(s){case"push":i(this,null,null,e.length,e.slice(e.length-1));break;case"pop":i(this,e.length,1);break;case"unshift":i(this,null,null,0,e.slice(0,1));break;case"shift":i(this,0,1);break;case"splice":var v=h[0],g=1===h.length?this.components.length:h[1],m=h.length>2?e.slice(h[0],h.length-2+h[0]):null;i(this,v,g,v,m);break;case"sort":case"reverse":n(this,e);break;case"remove":null!=c&&c.length&&r(this,c)}},dispose:function(){F(this.expr,this.model,this,this.refresh)}};return function(e,n,i,r){null==e.nodes&&"undefined"!=typeof Compo&&Compo.ensureTemplate(e);var o=e.attr.each||e.attr.foreach,s=R(o,n,i,e);C(e,{expr:o,binder:D(o,n,i,e,d.refresh.bind(e)),template:e.nodes,container:r,placeholder:document.createComment(""),dispose:d.dispose}),r.appendChild(e.placeholder),H(e.expr,n,i,e,e.binder);for(var l in f)e[l]=f[l];e.nodes=t(e,s)}}(),p=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=R(this.expr,this.model,this.cntx,this),t=0,n=this.elements.length;n>t;t++)this.elements[t].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){F(this.expr,this.model,this,this.binder)}};return function(t,n,i){var r=t.attr.visible;C(t,{expr:r,binder:D(r,n,i,t,e.refresh.bind(t)),dispose:e.dispose}),H(r,n,i,t,t.binder),e.refresh.call(t)}}();t.prototype={constructor:t,elements:null,renderStart:function(e,t,i){var o=this.attr;return null==o["debugger"]?null!=o.use?(n(this,e,t,i),void 0):null!=o.log?(r(this,e,t,i),void 0):(this.model=e,null!=o["if"]?(c(this,e,t,i),void 0):null!=o["else"]?(f(this,e,t,i),void 0):((null!=o.each||null!=o.foreach)&&d(this,e,t,i),void 0)):void 0},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&p(this,this.model,this.cntx)}}}(t),function(){var e,n,i=t.getStatement();(function(){e=function(e,t,n,r,o){return i[e].getNodes(t,n,r,o)},n=function(e,t,n,i,r,o){var s=[];if(w(e,t,n,i,r,s),null==o)return s;for(var l=o.length,a=s.length,u=-1;a>++u;)o[l+u]=s[u];return s}})(),function(){function i(){}var r={render:function(t,r,o,s,l){var a=this;new i;var u=e("if",a,t,r,s);return console.log(a,t),n(u,t,r,o,s,l)}};i.prototype={refresh:function(){(null!=this.elements||value)&&(null==this.elements?(o(l(this,this.template,this.model,this.cntx),this.placeholder),this.$=j(this.elements)):(null==this.$&&(this.$=j(this.elements)),this.$[value?"show":"hide"]()),this.onchange&&this.onchange(value))},dispose:function(){F(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}},t.registerHandler("+if",r)}()}()})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);