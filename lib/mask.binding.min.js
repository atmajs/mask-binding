(function(t,e){"use strict";function n(t,e){for(var n=0,i=e.length-1;i>n;n++){var r=e.shift();null==t[r]&&(t[r]={}),t=t[r]}return t}function i(t,e){if(null==e)return t;null==t&&(t={});for(var n in e)t[n]=e[n];return t}function r(t,e){for(var n=e.split("."),i=n.length,r=0;i>r;r++){if(null==t)return null;t=t[n[r]]}return t}function o(t,e,n){for(var i=e.split("."),r=i.length,o=0,s=null;r-1>o;o++)s=i[o],null==t[s]&&(t[s]={}),t=t[s];t[i[o]]=n}function s(t,e,i){if(null==t.__observers&&Object.defineProperty(t,"__observers",{value:{},enumerable:!1}),t.__observers[e])return t.__observers[e].push(i),void 0;var r=t.__observers[e]=[i],o=e.split("."),s=o.length>1?n(t,o):t,a=o[0],l=s[a];Object.defineProperty(s,a,{get:function(){return l},set:function(t){l=t;for(var e=0,n=r.length;n>e;e++)r[e](t)}})}function a(t,e){function n(n){t[n]=function(){Array.prototype[n].apply(this,arguments),e(this,n,arguments)}}Object.defineProperty(t,"hasObserver",{value:!0,enumerable:!1,writable:!1});for(var i=0,r=["push","unshift","splice","pop","shift","reverse","sort"],o=r.length;o>i;i++)n(r[i])}function l(t,e,n){return"function"==typeof g?(g(t).on(e,n),void 0):null!=t.addEventListener?(t.addEventListener(e,n,!1),void 0):(t.attachEvent&&t.attachEvent("on"+e,n),void 0)}function u(){}function d(){}function h(t,e,n,r){if(this.constructor===h){var o=n.attr.bindingProvider||e.tagName.toLowerCase();if(p[o]instanceof Function)return new p[o](t,e,n);i(this,p[o])}return null==r&&(r=":bind"===n.compoName?"single":"dual"),this.node=n,this.model=t,this.element=e,this.property=n.attr.property||("single"===r?"element.innerHTML":"element.value"),this.setter=n.attr.setter,this.getter=n.attr.getter,this.dismiss=0,s(t,n.attr.value,this.objectChanged.bind(this)),"single"!==r&&l(e,n.attr.changeEvent||"change",this.domChanged.bind(this)),this.objectChanged(),this}function c(){}function f(){}function v(t,e){if(null==e&&(e=[]),null==t.components)return e;for(var n,i=t.components,r=0,o=i.length;o>r;r++)n=i[r],"validate"!==n.compoName?v(n):e.push(n);return e}var g=window.jQuery||window.Zepto||window.$;null==g&&console.warn("Without jQuery/Zepto etc. binder is limited (mouse dom event bindings)"),e.registerHandler(":visible",u),u.prototype={constructor:u,refresh:function(t,n){n.style.display=e.Utils.Condition.isCondition(this.attr.check,t)?"":"none"},renderStart:function(t,e,n){this.refresh(t,n),this.attr.bind&&s(t,this.attr.bind,this.refresh.bind(this,t,n))}},e.registerHandler(":bind",d),d.prototype.renderStart=function(t,e,n){new h(t,n,this,"single")},e.registerUtility("bind",function(t,e,n,i,o,a,l){var u=r(e,t);switch(l){case"node":var d=document.createTextNode(u);return s(e,t,function(t){d.textContent=t}),d;case"attr":return s(e,t,function(t){var e=i.getAttribute(a);i.setAttribute(a,e?e.replace(u,t):t),u=t}),u}return console.error("Unknown binding type",arguments),"Unknown"});var p={};e.registerBinding=function(t,e){p[t]=e},e.BindingProvider=h,h.prototype={constructor:h,objectChanged:function(t){this.dismiss-->0||(null==t&&(t=this.objectWay.get(this.model,this.node.attr.value)),this.domWay.set(this,t),t instanceof Array&&t.hasObserver!==!0&&a(t,this.objectChanged.bind(this)))},domChanged:function(){var t=this.domWay.get(this);if(this.node.validations)for(var e,n=0,i=this.node.validations.length;i>n;n++)if(e=this.node.validations[n],e.validate(t,this.element,this.objectChanged.bind(this))===!1)return;this.dismiss=1,this.objectWay.set(this.model,this.node.attr.value,t),this.dismiss=0},objectWay:{get:function(t,n){return":"===n[0]?e.Utils.ConditionUtil.condition(n.substring(1)):r(t,n)},set:function(t,e,n){o(t,e,n)}},domWay:{get:function(t){if(t.getter){var e=t.node.parent;return null==e||"function"!=typeof e[t.getter]?(console.error("Mask.bindings: Getter should be a function",t.getter,t),null):e[t.getter]()}return r(t,t.property)},set:function(t,e){if(t.setter){var n=t.node.parent;if(null==n||"function"!=typeof n[t.setter])return console.error("Mask.bindings: Getter should be a function",t.getter,t),void 0;n[t.setter](e)}else o(t,t.property,e)}}},e.registerHandler(":dualbind",c),c.prototype.renderEnd=function(t,e,n,i){if(this.components)for(var r,o=0,s=this.components.length;s>o;o++)r=this.components[o],":validate"===r.compoName&&(this.validations||(this.validations=[])).push(r);new h(e,i,this)},function(){function t(){}function n(t,e,n){console.warn("Validate Notification:",t,e);var i=g(t).next(".-validate-invalid");0===i.length&&(i=g("<div>").addClass("-validate-invalid").html("<span></span><button>cancel</button>").insertAfter(t)),i.children("button").off().on("click",function(){i.hide(),n&&n()}).end().children("span").text(e).end().show()}function i(t){g(t).next(".-validate-invalid").hide()}e.registerValidator=function(t,e){o[t]=e},e.registerHandler(":validate",t),t.prototype={constructor:t,renderStart:function(t,e,n){this.element=n,this.model=t},validate:function(t,e,o){null==e&&(e=this.element),this.attr.getter&&(t=r({node:this,element:e},this.attr.getter)),null==this.validators&&this.initValidators();for(var s,a=0,l=this.validators.length;l>a;a++)if(s=this.validators[a],s.validate(this,t)===!1)return n(e,this.message,o),!1;return i(e),!0},initValidators:function(){this.validators=[],this.message=this.attr.message,delete this.attr.message;for(var t in this.attr)if(t in o!=!1){var e=o[t];"function"==typeof e&&(e=new e(this)),this.validators.push(e)}else console.error("Unknown Validator:",t,this)}};var o={match:{validate:function(t,e){return RegExp(t.attr.match).test(e)}},unmatch:{validate:function(t,e){return!RegExp(t.attr.unmatch).test(e)}},minLength:{validate:function(t,e){return e.length>=parseInt(t.attr.minLength,10)}},maxLength:{validate:function(t,e){return e.length<=parseInt(t.attr.maxLength,10)}}}}(),e.registerHandler(":validate:group",f),f.prototype={constructor:f,validate:function(){for(var t,e=v(this),n=0,i=e.length;i>n;n++)if(t=e[n],!t.validate())return!1;return!0}}})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);