UTest({
	'input text' () {
		var model = { foo: 'Foo' };
		var Ctor = Compo({
			template: "input > :dualbind value=foo",
			model: model,
		});
		var compo = mask.Compo.initialize(Ctor);
		notEq_(compo.$, null);
		
		var input = compo.$[0];
		
		eq_(input.value, 'Foo');
		
		model.foo = 'Baz';
		eq_(input.value, 'Baz');
		
		input.value = 'Quux';
		$(input).trigger('change');
		eq_(model.foo, 'Quux');
		
		eq_(compo.components.length, 1);
		eq_(model.__observers.foo.length, 1);
		
		compo.remove();
		eq_(model.__observers.foo.length, 0);
		
		'> dispose via jquery'
		var compo = mask.Compo.initialize(Ctor);
		eq_(model.__observers.foo.length, 1);
		compo.$.removeAndDispose();
		eq_(model.__observers.foo.length, 0);
	},
	
	'input date (debounced)' (done) {
		var model = { foo: new Date(2014, 1, 1) };
		var Ctor = Compo({
			template: "input type=date > :dualbind value=foo",
			model: model,
		});
		var compo = mask.Compo.initialize(Ctor);
		var input = compo.$[0];
		
		checkDates();
		
		'> change DOM'
		input.value = '2017-04-03';
		$(input).trigger('change');
		var date = checkDates();
		eq_(date.getFullYear(), 2017);
		
		'> change Object'
		model.foo.setFullYear(2020);
		setTimeout(function(){
			has_(input.value, '2020');
			done();
		});
		
		
		function checkDates() {
			var date = new Date(input.value);
			eq_(date.getFullYear(), model.foo.getFullYear());
			eq_(date.getMonth(), model.foo.getMonth());
			eq_(date.getDate(), model.foo.getDate());
			return date;
		}
	},
	'Object Getter/Setter' () {
		var model = {
			foo: 'bob',
			getFoo: assert.await(function (expression, model_, compo_) {
				eq_(model_, model);
				notEq_(compo_, null);
				
				eq_(expression, 'foo');
				
				return model.foo.toUpperCase();
			}),
			setFoo: assert.await(function(expression, value, model_, compo_){
				eq_(model_, model);
				eq_(compo_, compo);
				eq_(expression, 'foo');
				
				model.foo = value.toLowerCase();
			})
		};
		var Ctor = Compo({
			template: "input > :dualbind value=foo obj-getter=getFoo obj-setter=setFoo",
			model: model,
		});
		var compo = mask.Compo.initialize(Ctor);
		var input = compo.$[0];
		
		// initial value
		eq_(input.value, 'BOB');
		
		input.value = 'ALICE';
		$(input).trigger('change');
		
		// changed value
		eq_(model.foo, 'alice');
	},
	'Dom(Component) Getter/Setter' () {
		var model = {
			foo: 'bob'
		};
		mask.registerHandler(':transformer', Compo({
			getValue: assert.await(function (el) {
				return el.value.toLowerCase();
			}),
			setValue: assert.await(function (val, el) {
				el.value = val.toUpperCase();
			})
		}));

		var Ctor = Compo({
			template: `
				:transformer >
					input >
						:dualbind value=foo dom-getter=getValue dom-setter=setValue;
			`,
			model: model,
		});
		
		var compo = mask.Compo.initialize(Ctor);
		
		var input = compo.$[0];
		
		// initial value
		eq_(input.value, 'BOB');
		
		model.foo = 'alice';
		eq_(input.value, 'ALICE');
		
		input.value = 'JOHN';
		$(input).trigger('change');
		
		// changed value
		eq_(model.foo, 'john');
	}
})