(function(e,t){"use strict";function n(e,t){for(var n=t.split("."),r=n.length,i=0;r>i;i++){if(null==e)return null;e=e[n[i]]}return e}function r(e,t,n){for(var r=t.split("."),i=r.length,o=0,s=null;i-1>o;o++)s=r[o],null==e[s]&&(e[s]={}),e=e[s];e[r[o]]=n}function i(e,t,n){if(null==e.__observers&&Object.defineProperty(e,"__observers",{value:{},enumerable:!1}),e.__observers[t]){e.__observers[t].push(n);var r=getProperty(e,t);return r instanceof Array&&observeArray(r,n),void 0}var i=e.__observers[t]=[n],o=t.split("."),s=o.length>1?ensureObject(e,o):e,l=o[0],a=s[l];Object.defineProperty(s,l,{get:function(){return a},set:function(e){a=e;for(var t=0,r=i.length;r>t;t++)i[t](e);a instanceof Array&&observeArray(a,n)}}),a instanceof Array&&observeArray(a,n)}function o(e){return e.parentNode.removeChild(e)}function s(e){if(null!=e)for(var t=0,n=e.length;n>t;t++)o(e[t])}function l(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function a(e,t){return t.parentNode.insertBefore(e,t)}function u(e,t,n){return"function"==typeof w?(w(e).on(t,n),void 0):null!=e.addEventListener?(e.addEventListener(t,n,!1),void 0):(e.attachEvent&&e.attachEvent("on"+t,n),void 0)}function d(e,t,n){if(null==e.components)return l(n,e.placeholder);for(var r,i=e.components,o=null,s=!0,u=i.length,d=t;u>d;d++)if(r=i[d].elements,r&&r.length){o=r[0];break}if(null==o)for(s=!1,d=u>t?t:u;--d>-1;)if(r=i[d].elements,r&&r.length){o=r[r.length-1];break}return null==o&&(o=e.placeholder),s?a(n,o):l(n,o)}function h(e,n,r,i,o){return t.render(n,r,i,o,e)}function c(e){if(null!=e){s(e.elements),e.elements=null,"undefined"!=typeof Compo&&Compo.dispose(e);var t=e.parent&&e.parent.components;if(null!=t){var n=t.indexOf(this);-1!==n&&t.splice(n,1)}}}function f(e){"undefined"!=typeof Compo&&Compo.signal.emitIn(e,"domInsert")}function p(){}function m(){}function v(e,t,n,r){if(this.constructor===v){var o=n.attr.bindingProvider||t.tagName.toLowerCase();if(C[o]instanceof Function)return new C[o](e,t,n);extendObject(this,C[o])}return null==r&&(r=":bind"===n.compoName?"single":"dual"),this.node=n,this.model=e,this.element=t,this.property=n.attr.property||("single"===r?"element.innerHTML":"element.value"),this.setter=n.attr.setter,this.getter=n.attr.getter,this.dismiss=0,i(e,n.attr.value,this.objectChanged.bind(this)),"single"!==r&&u(t,n.attr.changeEvent||"change",this.domChanged.bind(this)),this.objectChanged(),this}function g(){}function b(){}function y(e,t){if(null==t&&(t=[]),null==e.components)return t;for(var n,r=e.components,i=0,o=r.length;o>i;i++)n=r[i],"validate"!==n.compoName?y(n):t.push(n);return t}var w=window.jQuery||window.Zepto||window.$;null==w&&console.warn("Without jQuery/Zepto etc. binder is limited (mouse dom event bindings)"),t.registerHandler(":visible",p),p.prototype={constructor:p,refresh:function(e,n){n.style.display=t.Utils.Condition.isCondition(this.attr.check,e)?"":"none"},renderStart:function(e,t,n){this.refresh(e,n),this.attr.bind&&i(e,this.attr.bind,this.refresh.bind(this,e,n))}},t.registerHandler(":bind",m),m.prototype.renderStart=function(e,t,n){new v(e,n,this,"single")},t.registerUtility("bind",function(e,t,r,o,s,l,a){var u=n(t,e);switch(a){case"node":var d=document.createTextNode(u);return i(t,e,function(e){d.textContent=e}),d;case"attr":return i(t,e,function(e){var t=o.getAttribute(l);o.setAttribute(l,t?t.replace(u,e):e),u=e}),u}return console.error("Unknown binding type",arguments),"Unknown"});var C={};t.registerBinding=function(e,t){C[e]=t},t.BindingProvider=v,v.prototype={constructor:v,objectChanged:function(e){this.dismiss-->0||(null==e&&(e=this.objectWay.get(this.model,this.node.attr.value)),this.domWay.set(this,e))},domChanged:function(){var e=this.domWay.get(this);if(this.node.validations)for(var t,n=0,r=this.node.validations.length;r>n;n++)if(t=this.node.validations[n],t.validate(e,this.element,this.objectChanged.bind(this))===!1)return;this.dismiss=1,this.objectWay.set(this.model,this.node.attr.value,e),this.dismiss=0},objectWay:{get:function(e,r){return":"===r[0]?t.Utils.ConditionUtil.condition(r.substring(1)):n(e,r)},set:function(e,t,n){r(e,t,n)}},domWay:{get:function(e){if(e.getter){var t=e.node.parent;return null==t||"function"!=typeof t[e.getter]?(console.error("Mask.bindings: Getter should be a function",e.getter,e),null):t[e.getter]()}return ogj_getProperty(e,e.property)},set:function(e,t){if(e.setter){var n=e.node.parent;if(null==n||"function"!=typeof n[e.setter])return console.error("Mask.bindings: Getter should be a function",e.getter,e),void 0;n[e.setter](t)}else r(e,e.property,t)}}},t.registerHandler(":dualbind",g),g.prototype.renderEnd=function(e,t,n,r){if(this.components)for(var i,o=0,s=this.components.length;s>o;o++)i=this.components[o],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);new v(t,r,this)},function(){function e(){}function n(e,t,n){console.warn("Validate Notification:",e,t);var r=w(e).next(".-validate-invalid");0===r.length&&(r=w("<div>").addClass("-validate-invalid").html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),n&&n()}).end().children("span").text(t).end().show()}function r(e){w(e).next(".-validate-invalid").hide()}t.registerValidator=function(e,t){i[e]=t},t.registerHandler(":validate",e),e.prototype={constructor:e,renderStart:function(e,t,n){this.element=n,this.model=e},validate:function(e,t,i){null==t&&(t=this.element),this.attr.getter&&(e=getProperty({node:this,element:t},this.attr.getter)),null==this.validators&&this.initValidators();for(var o,s=0,l=this.validators.length;l>s;s++)if(o=this.validators[s],o.validate(this,e)===!1)return n(t,this.message,i),!1;return r(t),!0},initValidators:function(){this.validators=[],this.message=this.attr.message,delete this.attr.message;for(var e in this.attr)if(e in i!=!1){var t=i[e];"function"==typeof t&&(t=new t(this)),this.validators.push(t)}else console.error("Unknown Validator:",e,this)}};var i={match:{validate:function(e,t){return RegExp(e.attr.match).test(t)}},unmatch:{validate:function(e,t){return!RegExp(e.attr.unmatch).test(t)}},minLength:{validate:function(e,t){return t.length>=parseInt(e.attr.minLength,10)}},maxLength:{validate:function(e,t){return t.length<=parseInt(e.attr.maxLength,10)}}}}(),t.registerHandler(":validate:group",b),b.prototype={constructor:b,validate:function(){for(var e,t=y(this),n=0,r=t.length;r>n;n++)if(e=t[n],!e.validate())return!1;return!0}},function(e){function t(){}function n(e,t,n,r,i){var o=p.parse(e),s=p.varRefs(o),l=p.eval(o,t);if(null==s)return l;if("string"==typeof s)return addObjectObserver(t,s,i),l;for(var a,u=0,d=s.length;d>u;u++)a=s[u],addObjectObserver(t,a,i);return l}function r(e,t,n){var r=p.parse(e),i=p.varRefs(r);if(null!=i){if("string"==typeof i)return removeObjectObserver(t,i,n),void 0;for(var o,s=0,l=i.length;l>s;s++)o=i[s],removeObjectObserver(t,o,n)}}e.registerHandler("%%",t);var i=function(){function t(t){if(this.model=t,this.elements)for(var n,r=0,i=this.elements.length;i>r;r++)n=this.elements[r],n.parentNode.removeChild(n);"undefined"!=typeof Compo&&Compo.dispose(this),e.render(this.nodes,this.model,this.cntx).insertBefore(this.placeholder)}return function(e,n,r,i){var o=e.attr.use;e.placeholder=document.createComment(""),e.model=bind_expression(o,n,r,e,t.bind(e)),i.appendChild(e.placeholder)}}(),o=function(){return function(e,t,n){function r(e){console.log("Key: %s, Value: %s",i,e)}var i=e.attr.log,o=bind_expression(i,t,n,e,r);r(o),e=null,t=null,n=null}}(),s=function(){function t(t){(null!=this.elements||t)&&(null==this.elements?(e.render(this.template,this.model,this.cntx,null,this).insertBefore(this.placeholder),this.$=w(this.elements)):(null==this.$&&(this.$=w(this.elements)),this.$[t?"show":"hide"]()),this.onchange&&this.onchange(t))}return function(e,n,r,i){var o=e.attr["if"];e.placeholder=document.createComment(""),e.template=e.nodes,e.state=!!bind_expression(o,n,r,e,t.bind(e)),e.state||(e.nodes=null),i.appendChild(e.placeholder)}}(),l=function(){function t(t){if(null!=this.elements||!t){if(null==this.elements)return e.render(this.template,this.model,this.cntx,null,this).insertBefore(this.placeholder),this.$=w(this.elements),void 0;null==this.$&&(this.$=w(this.elements)),this.$[t?"hide":"show"]()}}return function(e,n,r,i){var o=e.parent.components,s=o&&o[o.length-1];return e.template=e.nodes,e.placeholder=document.createComment(""),null==s||"%%"!==s.compoName||null==s.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(s.onchange=t.bind(e),s.state&&(sellf.nodes=null),i.appendChild(e.placeholder),void 0)}}(),u=function(){function t(e,t){var n=[];if(t instanceof Array==!1)return n;for(var r,i=0,o=t.length;o>i;i++){switch(r=t[i],typeof r){case"string":r=t[i]=new String(r);break;case"number":r=t[i]=new Number(r);break;case"boolean":r=t[i]=new Boolean(r)}n[i]=new p(e,r)}return n}function i(e,t){for(var n=e.components,r=0,i=n.length,o=0,s=null,l=null,u=null,d=document.createDocumentFragment(),h=[];i>r;r++)if(u=n[r],null!=u.elements&&0!==u.elements.length)for(o=0,s=u.elements.length;s>o;o++)l=u.elements[o],l.parentNode.removeChild(l);e:for(o=0,s=t.length;s>o;o++){for(r=0;i>r;r++)if(t[o]===n[r].model){h[o]=n[r];continue e}console.warn("No Model Found for",t[o])}for(r=0,i=h.length;i>r;r++)if(u=h[r],null!=u.elements&&0!==u.elements.length)for(o=0,s=u.elements.length;s>o;o++)l=u.elements[o],d.appendChild(l);e.components=h,a(d,e.placeholder)}function o(e,n,r,i,o){if(null!=n&&null!=r){var s=n,l=n+r;for(l>e.components.length&&(l=e.components.length);l>s;s++)c(e.components[s])}if(null!=i&&o&&o.length){var a=new u,p=t(e.template,o),m=h(a,p),v=a.components;d(e,i,m),f(a),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[i,0].concat(v))}}function s(e,n,r){if(null==n){for(var s,l=0,u=this.components.length;u>l;l++)c(this.components[l]);return this.components=[],this.nodes=t(this.template,e),a(h(this,this.nodes),this.placeholder),void 0}for(var s,l=0,u=e.length;u>l;l++)switch(s=e[l],typeof s){case"string":e[l]=new String(s);break;case"number":e[l]=new Number(s);break;case"boolean":e[l]=new Boolean(s)}switch(n){case"push":o(this,null,null,e.length,e.slice(e.length-1));break;case"pop":o(this,e.length,1);break;case"unshift":o(this,null,null,0,e.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":o(this,r[0],r[1],r[0],e.slice(r[0],r.length-2));break;case"sort":case"reverse":i(this,e)}}function l(){r(self.expr,self.model,self.refresh)}var u=e.Dom.Component,p=function(){function e(e,t){this.nodes=e,this.model=t}var t=u.prototype;e.prototype={constructor:m,renderEnd:function(e){this.elements=e}};for(var n in t)e.prototype[n]=t[n];return e}(),m={append:function(t){var n;n=new p,n.nodes=this.template,n.model=t,e.render(n,t,null,this.container,this)}};return function(e,r,i,o){null==e.nodes&&"undefined"!=typeof Compo&&Compo.ensureTemplate(e),e.refresh=s.bind(e),e.dispose=l,e.expr=e.attr.each||e.attr.foreach;var a=n(e.expr,r,i,e,e.refresh);e.template=e.nodes,e.container=o,e.placeholder=document.createComment(""),o.appendChild(e.placeholder);for(var u in m)e[u]=m[u];e.nodes=t(e.template,a)}}();t.prototype={constructor:t,elements:null,renderStart:function(e,t,n){var r=this.attr;if(null==r["debugger"])return null!=r.use?(i(this,e,t,n),void 0):null!=r.log?(o(this,e,t,n),void 0):(this.model=e,null!=r["if"]?(s(this,e,t,n),void 0):null!=r["else"]?(l(this,e,t,n),void 0):((null!=r.each||null!=r.foreach)&&u(this,e,t,n),void 0))},render:null,renderEnd:function(e){this.elements=e}};var p=e.Utils.Expression}(t)})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);