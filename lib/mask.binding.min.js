(function(t,e){"use strict";function n(t,e){for(var n=0,i=e.length-1;i>n;n++){var r=e.shift();null==t[r]&&(t[r]={}),t=t[r]}return t}function i(t,e){if(null==e)return t;null==t&&(t={});for(var n in e)t[n]=e[n];return t}function r(t,e){for(var n=e.split("."),i=n.length,r=0;i>r;r++){if(null==t)return null;t=t[n[r]]}return t}function s(t,e,n){for(var i=e.split("."),r=i.length,s=0,o=null;r-1>s;s++)o=i[s],null==t[o]&&(t[o]={}),t=t[o];t[i[s]]=n}function o(t,e,i){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{},enumerable:!1});var r=t.__observers[e]||(t.__observers[e]=[]),s=e.split("."),o=s.length>1?n(t,s):t,a=s[0],h=o[a];r.push(i),Object.defineProperty(o,a,{get:function(){return h},set:function(t){h=t;for(var e=0,n=r.length;n>e;e++)r[e](t)}})}function a(t,e){function n(n){t[n]=function(){Array.prototype[n].apply(this,arguments),e(this,n,arguments)}}Object.defineProperty(t,"hasObserver",{value:!0,enumerable:!1,writable:!1});for(var i=0,r=["push","unshift","splice","pop","shift","reverse","sort"],s=r.length;s>i;i++)n(r[i])}function h(t,e,n){return"function"==typeof p?(p(t).on(e,n),void 0):null!=t.addEventListener?(t.addEventListener(e,n,!1),void 0):(t.attachEvent&&t.attachEvent("on"+e,n),void 0)}function l(){}function u(t,e,n){if(this.constructor==u){var r=n.attr.bindingProvider||e.tagName.toLowerCase();if(g[r]instanceof Function)return new g[r](t,e,n);i(this,g[r])}this.node=n,this.model=t,this.element=e,this.property=n.attr.property||"element.value",this.setter=n.attr.setter,this.getter=n.attr.getter,this.dismiss=0;var s=n.attr.changeEvent||"change";return o(t,n.attr.value,this.objectChanged.bind(this)),h(e,s,this.domChanged.bind(this)),this.objectChanged(),this}function d(){}function c(){}function f(t,e){if(null==e&&(e=[]),null==t.components)return e;for(var n,i=t.components,r=0,s=i.length;s>r;r++)n=i[r],"validate"!==n.compoName?f(n):e.push(n);return e}function v(t,e){return null==t?null:"function"==typeof t[e]?t[e].bind(t):v(t.parent,e)}var p=t.jQuery||t.Zepto||t.$;e.registerHandler(":visible",Class({Extends:e.ValueUtils.out,refresh:function(t,e){e.style.display=this.isCondition(this.attr.check,t)?"":"none"},render:function(t,n,i){this.refresh(t,n),this.attr.bind&&o(t,this.attr.bind,this.refresh.bind(this,t,n)),this.nodes&&e.render(this.nodes,t,n,i)}})),e.registerHandler(":bind",l),l.prototype={refresh:function(t,e,n){null!=this.attr.attr?e.setAttribute(this.attr.attr,n):null!=this.attr.prop?e[this.attr.prop]=n:e.innerHTML=n},render:function(t,n,i){this.refresh(t,n,Object.getProperty(t,this.attr.value)),o(t,this.attr.value,this.refresh.bind(this,t,n)),this.nodes&&e.render(this.nodes,t,n,i)}},e.registerUtility("bind",function(t,e,n,i,s,a){var h=r(e,t);switch(n){case"node":var l=document.createTextNode(h);return o(e,t,function(t){l.textContent=t}),l;case"attr":return o(e,t,function(t){var e=s.getAttribute(a);s.setAttribute(a,e.replace(h,t)),h=t}),h}return console.error("Unknown binding type",arguments),"Unknown"});var g={};e.registerBinding=function(t,e){g[t]=e},e.BindingProvider=u,u.prototype={constructor:u,objectChanged:function(t){this.dismiss-->0||(null==t&&(t=this.objectWay.get(this.model,this.node.attr.value)),this.domWay.set(this,t),t instanceof Array&&t.hasObserver!==!0&&a(t,this.objectChanged.bind(this)))},domChanged:function(){var t=this.domWay.get(this);if(this.node.validations)for(var e,n=0,i=this.node.validations.length;i>n;n++)if(e=this.node.validations[n],e.validate(t,this.element,this.objectChanged.bind(this))===!1)return;this.dismiss=1,this.objectWay.set(this.model,this.node.attr.value,t),this.dismiss=0},objectWay:{get:function(t,e){return r(t,e)},set:function(t,e,n){s(t,e,n)}},domWay:{get:function(t){return t.getter?t.node.parent[t.getter]():r(t,t.property)},set:function(t,e){t.setter?t.node.parent[t.setter](e):s(t,t.property,e)}}},e.registerHandler(":dualbind",d),d.prototype.render=function(t,n,i){if(this.nodes&&e.render(this.nodes,t,n,i),i.components)for(var r,s=0,o=i.components.length;o>s;s++)r=i.components[s],":validate"==r.compoName&&(this.validations||(this.validations=[])).push(r);new u(t,n,this)},function(){function t(){}function n(t,e,n){console.warn("Validate Notification:",t,e);var i=p(t).next(".-validate-invalid");0===i.length&&(i=p("<div>").addClass("-validate-invalid").html("<span></span><button>cancel</button>").insertAfter(t)),i.children("button").off().on("click",function(){i.hide(),n&&n()}).end().children("span").text(e).end().show()}function i(t){p(t).next(".-validate-invalid").hide()}e.registerValidator=function(t,e){s[t]=e},e.registerHandler(":validate",t),t.prototype={constructor:t,render:function(t,e){this.element=e,this.model=t},validate:function(t,e,s){null==e&&(e=this.element),this.attr.getter&&(t=r({node:this,element:e},this.attr.getter)),null==this.validators&&this.initValidators();for(var o,a=0,h=this.validators.length;h>a;a++)if(o=this.validators[a],o.validate(this,t)===!1)return n(e,this.message,s),!1;return i(e),!0},initValidators:function(){this.validators=[],this.message=this.attr.message,delete this.attr.message;for(var t in this.attr)if(t in s!=!1){var e=s[t];"function"==typeof e&&(e=new e(this)),this.validators.push(e)}else console.error("Unknown Validator:",t,this)}};var s={match:{validate:function(t,e){return RegExp(t.attr.match).test(e)}},unmatch:{validate:function(t,e){return!RegExp(t.attr.unmatch).test(e)}},minLength:{validate:function(t,e){return e.length>=parseInt(t.attr.minLength,10)}},maxLength:{validate:function(t,e){return e.length<=parseInt(t.attr.maxLength,10)}},check:{validate:function(){}}}}(),e.registerHandler(":validate:group",c),c.prototype={constructor:c,render:function(t,n,i){e.render(this.nodes,t,n,i)},validate:function(){for(var t,e=f(this),n=0,i=e.length;i>n;n++)if(t=e[n],!t.validate())return!1;return!0}},e.registerAttrHandler("x-on",function(t,e,n,i,r){for(var s,o=n.split(";"),a=0,l=o.length;l>a;a++){s=o[a];var u=s.substring(0,s.indexOf(":")),d=s.substring(s.indexOf(":")+1).trim(),c=v(r,d);c&&h(i,u,c)}})})("undefined"==typeof window?global:window,"undefined"==typeof mask?null:mask);